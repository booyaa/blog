<!DOCTYPE html>
<html lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta http-equiv="content-type" content="text/html; charset=utf-8" />

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1" />

  <title>
    
      Unhandled Expression &middot; Geoffroy Couprie – software security and architecture consultant
    
  </title>

  
  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-117988815-1', 'auto');
  ga('send', 'pageview');
  </script>



  <!-- CSS -->
  <link rel="stylesheet" href="/assets/css/main.css" />
  

<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Abril+Fatface" />

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/favicon.png" />
<link rel="shortcut icon" href="/favicon.ico" />

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/feed.xml" />

  <!-- Additional head bits without overriding original head -->
</head>


  <body class="index">

    <div id="sidebar">
  <header>
    <img src="https://s.gravatar.com/avatar/ed9901b9b80743c05aedf58b4f4926dd?s=200" alt="self" />
    <h1 class="site-title">
      <a href="/">
        
          <span class="back-arrow icon"><svg fill="#000000" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
  <path d="M0 0h24v24H0z" fill="none"/>
  <path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/>
</svg></span>
        
        Unhandled Expression
      </a>
    </h1>
    <p class="lead">Geoffroy Couprie – software security and architecture consultant</p>
  </header>
  <nav id="sidebar-nav-links">
  
    <a class="home-link "
        href="/">Home</a>
  
  

  

  


  
    
  

  
    
      <a class="page-link "
          href="/about.html">About</a>
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  


  


  
    
  

  
    
  

  
    
      <a class="category-link "
          href="/category/architecture.html">Architecture</a>
    
  

  
    
      <a class="category-link "
          href="/category/crypto.html">Crypto</a>
    
  

  
    
      <a class="category-link "
          href="/category/development.html">Development</a>
    
  

  
    
  

  

  
    
      <a class="category-link "
          href="/category/rust.html">Rust</a>
    
  

  
    
  

  
    
      <a class="category-link "
          href="/category/security.html">Security</a>
    
  

  
    
  

  
    
      <a class="category-link "
          href="/category/videolan.html">VideoLAN</a>
    
  

  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  


  <!-- Optional additional links to insert in sidebar nav -->
</nav>


  <nav id="sidebar-icon-links">
  

  <a id="subscribe-link"
     class="icon" title="Subscribe" aria-label="Subscribe"
     href="/feed.xml">
    <svg fill="#000000" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
    <path d="M0 0h24v24H0z" fill="none"/>
    <circle cx="6.18" cy="17.82" r="2.18"/>
    <path d="M4 4.44v2.83c7.03 0 12.73 5.7 12.73 12.73h2.83c0-8.59-6.97-15.56-15.56-15.56zm0 5.66v2.83c3.9 0 7.07 3.17 7.07 7.07h2.83c0-5.47-4.43-9.9-9.9-9.9z"/>
</svg>
  </a>

  
  
  
  

  
    <a id="tags-link"
       class="icon"
       title="Tags" aria-label="Tags"
       href="/tags.html">
      <svg fill="#000000" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
    <path d="M0 0h24v24H0z" fill="none"/>
    <path d="M17.63 5.84C17.27 5.33 16.67 5 16 5L5 5.01C3.9 5.01 3 5.9 3 7v10c0 1.1.9 1.99 2 1.99L16 19c.67 0 1.27-.33 1.63-.84L22 12l-4.37-6.16z"/>
</svg>
    </a>
  

  
    <a id="search-link"
       class="icon"
       title="Search" aria-label="Search"
       href="/search.html">
      <svg fill="#000000" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
    <path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/>
    <path d="M0 0h24v24H0z" fill="none"/>
</svg>
    </a>
  

  <!-- Optional additional links to insert for icons links -->
</nav>
  <p>
  &copy; 2018.
  <a href="/LICENSE.md">MIT License.</a>
</p>

</div>


    <main class="container">
      <div class="content">
  
<div class="pagination">
  <a class="pagination-item newer"
     href="/page8">
    Newer
  </a>
</div>



  

  
  <article class="post-body">
    <h2 class="post-title">
      <a href="/development/ruby/security/2011/06/28/rails-and-oauth-plugin-part-2-the-consumer.html">
        Rails and oauth-plugin part 2: the consumer
      </a>
    </h2>
    <div class="post-meta">
  <span class="post-date">28 Jun 2011</span>
  <span class="post-categories">
    
      &bull;

      
      
      

      
        <a href="/category/development.html">
          Development
        </a>
      
    
      &bull;

      
      
      

      
        Ruby
      
    
      &bull;

      
      
      

      
        <a href="/category/security.html">
          Security
        </a>
      
    
  </span>
</div>

    
      <p>In the previous post, I showed how you could build a provider with oauth-plugin and Rails. Now, I will demonstrate how to build a consumer (it's a lot easier).</p>
<p>I will assume that your provider is already running on localhost:3000. The consumer will run on localhost:4000 (run it with "rails server -p 4000").</p>
<h2>Here we go!</h2>
<p>[sourcecode language="bash"]<br />
rails new consumer<br />
cd consumer<br />
[/sourcecode]</p>
<p>Put this in your Gemfile:</p>
<p>[sourcecode language="ruby"]<br />
source 'http://rubygems.org'<br />
gem 'rails', '3.0.7'<br />
gem 'sqlite3'<br />
gem 'devise'<br />
gem &quot;oauth-plugin&quot;, &quot;&gt;= 0.4.0.pre1&quot;<br />
[/sourcecode]</p>
<p>And run these commands:</p>
<p>[sourcecode language="bash"]<br />
bundle install<br />
rails generate devise:install<br />
rails generate devise User<br />
rake db:migrate<br />
rails generate controller welcome index<br />
rm public/index.html<br />
[/sourcecode]</p>
<p>And here is your routes.rb:</p>
<p>[sourcecode language="ruby"]<br />
Provider::Application.routes.draw do<br />
devise_for :users<br />
root :to =&gt; &quot;welcome#index&quot;<br />
end<br />
[/sourcecode]</p>
<h2>Create the consumer</h2>
<p>[sourcecode language="bash"]<br />
rails generate oauth_consumer user<br />
rake db:migrate<br />
[/sourcecode]</p>
<p>in app/controllers/oauth_consumers_controller.rb, replace:</p>
<p>[sourcecode language="ruby"]<br />
before_filter :login_required, :only=&gt;:index<br />
[/sourcecode]</p>
<p>by</p>
<p>[sourcecode language="ruby"]<br />
before_filter :authenticate_user!, :only=&gt;:index<br />
[/sourcecode]</p>
<p>Uncomment the methods for devise (go_back, logged_in? currentuser=, deny_access!) in app/controllers/oauth_consumers_controller.rb.</p>
<p>Add to app/models/user.rb:</p>
<p>[sourcecode language="ruby"]<br />
 has_one  :test, :class_name=&gt;&quot;TestToken&quot;, :dependent=&gt;:destroy<br />
[/sourcecode]</p>
<p>Now go to http://localhost:3000/oauth_clients/ to register your first application with these parameters:</p>
<blockquote><p>Name:                 Test consumer<br />
Main Application URL: http://localhost:4000/<br />
Callback URL:         http://localhost:4000/oauth_consumers/test/callback</p></blockquote>
<p>You're redirected to http://localhost:3000/oauth_clients/1. It shows:</p>
<blockquote><p>Consumer Key:      CRcIJ15MwSqlDTxsH8MpO3En4wjaOxkqeofLioH4</p>
<p>Consumer Secret:   C7uci8xkyMShCf4SNXWPclKbBo3ml1Zf2W2XWu4W</p>
<p>Request Token URL: http://localhost:3000/oauth/request_token</p>
<p>Access Token URL:  http://localhost:3000/oauth/access_token</p>
<p>Authorize URL:     http://localhost:3000/oauth/authorize</p></blockquote>
<p>Now, you need to put the key and secret in config/initializers/oauth_consumers.rb:</p>
<p>[sourcecode language="ruby"]<br />
 OAUTH_CREDENTIALS={<br />
:test =&gt;{<br />
:key =&gt; &quot;CRcIJ15MwSqlDTxsH8MpO3En4wjaOxkqeofLioH4&quot;,<br />
     :secret =&gt; &quot;C7uci8xkyMShCf4SNXWPclKbBo3ml1Zf2W2XWu4W&quot;,<br />
     :expose =&gt; true<br />
   }<br />
 }<br />
[/sourcecode]</p>
<p>Create app/models/test_token.rb. This model will store the token for your provider. If you want to provide helpful methods, take inspiration from lib/oauth/models/consumers/services/.</p>
<p>[sourcecode language="ruby"]<br />
class TestToken &lt; ConsumerToken<br />
TEST_SETTINGS={<br />
:site =&gt; &quot;http://localhost:3000&quot;,<br />
:request_token_path =&gt; &quot;/oauth/request_token&quot;,<br />
:access_token_path =&gt; &quot;/oauth/access_token&quot;,<br />
:authorize_path =&gt; &quot;/oauth/authorize&quot;<br />
}</p>
<p>def self.consumer(options={})<br />
@consumer ||= OAuth::Consumer.new(credentials[:key], credentials[:secret], TEST_SETTINGS.merge(options))<br />
end</p>
<p>end<br />
[/sourcecode]</p>
<p>You should now be able to use the URLs "/oauth_consumers/test/client/", "/oauth_consumers/test/callback", "/oauth_consumers/test/callback2"," /oauth_consumers/test/edit",<br />
and "/oauth_consumers/test".</p>
<p>Modify the welcome controller t get the provider data:</p>
<p>[sourcecode language="ruby"]<br />
 class WelcomeController &lt; ApplicationController<br />
 def index<br />
 # cf http://oauth.rubyforge.org/rdoc/classes/OAuth/AccessToken.html<br />
 @consumer_tokens=TestToken.all :conditions=&gt;{:user_id=&gt;current_user.id}<br />
 @token = @consumer_tokens.first.client<br />
 logger.info &quot;private data: &quot;+@token.get(&quot;/data/index&quot;).body<br />
 end</p>
<p>end<br />
[/sourcecode]</p>
<p>To connect a user to an external service link or redirect them to:</p>
<p>/oauth_consumers/[SERVICE_NAME]</p>
<p>Where SERVICE_NAME is the name you set in the OAUTH_CREDENTIALS hash. This will request the request token and redirect the user to the services authorization screen. When the user accepts the get redirected back to:</p>
<p>/oauth_consumers/[SERVICE_NAME]/callback</p>
<h2>That's it</h2>
<p>This tutorial is really short, and could be explained a bit more, but I'll leave that for another post. You have enough to start tinkering with OAuth. Have fun!</p>

    

    
      
      
      

      
    
  </article>
  
  <article class="post-body">
    <h2 class="post-title">
      <a href="/development/ruby/security/2011/06/02/rails-and-oauth-plugin-part-1-the-provider.html">
        Rails and oauth-plugin part 1: the provider
      </a>
    </h2>
    <div class="post-meta">
  <span class="post-date">02 Jun 2011</span>
  <span class="post-categories">
    
      &bull;

      
      
      

      
        <a href="/category/development.html">
          Development
        </a>
      
    
      &bull;

      
      
      

      
        Ruby
      
    
      &bull;

      
      
      

      
        <a href="/category/security.html">
          Security
        </a>
      
    
  </span>
</div>

    
      <p>These days, I have been playing a lot with Oauth and its RoR implementation, <a title="Oauth-plugin" href="http://code.google.com/p/oauth-plugin/">oauth-plugin</a>. Its documentation is a bit short, so here is a tutorial to show how to use it, both in provider and consumer mode. And we will even make them communicate with each other.</p>
<p>We will now build an Oauth provider using oauth-plugin for authorization and Devise for authentication. And we will add a controller protected by Oauth.</p>
<h2>Starting up</h2>
<p>A few instructions to create the application. You won't need an explanation for this:</p>
<p>[sourcecode language="bash"]<br />
rails new provider<br />
cd provider<br />
[/sourcecode]</p>
<p>Put this in your Gemfile:</p>
<p>[sourcecode language="ruby"]<br />
source 'http://rubygems.org'<br />
gem 'rails', '3.0.7'<br />
gem 'sqlite3'<br />
gem 'devise'<br />
gem &quot;oauth-plugin&quot;, &quot;&gt;= 0.4.0.pre1&quot;<br />
[/sourcecode]</p>
<p>And a few more commands:</p>
<p>[sourcecode language="bash"]<br />
bundle install<br />
rails generate devise:install<br />
rails generate devise User<br />
rake db:migrate<br />
rails generate controller welcome index<br />
rm public/index.html<br />
[/sourcecode]</p>
<p>And don't forget 'root :to =&gt; "welcome#index"' in config/routes.rb.</p>
<h2>Create the provider</h2>
<p>[sourcecode language="bash"]<br />
rails generate oauth_provider oauth</p>
<p>rake db:migrate<br />
[/sourcecode]</p>
<p>You could put something else than "oauth" as parameter, but for the moment, the generator has some bugs (it always generate the class OauthController, but with a different name). I'll check more recent versions of the code.</p>
<p>Now, modify config/application.rb and add:</p>
<p>[sourcecode language="ruby"]<br />
require 'oauth/rack/oauth_filter'<br />
config.middleware.use OAuth::Rack::OAuthFilter<br />
[/sourcecode]</p>
<p>Put in app/models/user.rb:</p>
<p>[sourcecode language="ruby"]</p>
<p>has_many :client_applications</p>
<p>has_many :tokens, :class_name=&gt;&quot;OauthToken&quot;,:order=&gt;&quot;authorized_at desc&quot;,:include=&gt;[:client_application]</p>
<p>[/sourcecode]</p>
<p>Put in app/controllers/oauth_controller.rb:</p>
<p>[sourcecode language="ruby"]</p>
<p>alias :logged_in? :user_signed_in?</p>
<p>alias :login_required :authenticate_user!</p>
<p>[/sourcecode]</p>
<p>and uncomment authenticate_user.</p>
<p>Put in app/controllers/oauth_clients_controller.rb:</p>
<p>[sourcecode language="ruby"]<br />
alias :login_required :authenticate_user!<br />
[/sourcecode]</p>
<h2>And now some data</h2>
<p>Create a new controller:</p>
<p>[sourcecode language="bash"]</p>
<p>rails generate controller data index</p>
<p>[/sourcecode]</p>
<p>And now, edit your controller:</p>
<p>[sourcecode language="ruby"]<br />
class DataController &lt; ApplicationController<br />
  before_filter :oauth_required</p>
<p>  def index<br />
    @data = { &quot;coincoin&quot; =&gt; &quot;o&lt; o&lt;&quot; }</p>
<p>    respond_to do |format|<br />
      format.json { render :json =&gt; @data }<br />
    end</p>
<p>  end<br />
end<br />
[/sourcecode]</p>
<h3>UPDATE</h3>
<p>I discovered a few bugs in this tutorial, so here are the fixes.</p>
<p>oauth-plugin needs the function current_user=, so add this to your ApplicationController:</p>
<p>[sourcecode language="ruby"]<br />
def current_user=(user)<br />
  current_user = user<br />
end<br />
[/sourcecode]</p>
<p>Next, to handle revocation, you need to add this to config/routes.rb:</p>
<p>[sourcecode language="ruby"]<br />
post 'oauth/revoke'<br />
[/sourcecode]</p>
<p>And at last, you need to fix the rack filter. The current code doesn't verify the token validity, and lets revoked tokens access your data.<br />
You have to modify lib/oauth/rack/oauth_filter.rb in the oauth-plugin gem folder.<br />
Replace the line 46:</p>
<p>[sourcecode language="ruby"]<br />
oauth_token = client_application.tokens.first(:conditions=&gt;{:token =&gt; request_proxy.token})<br />
[/sourcecode]</p>
<p>by</p>
<p>[sourcecode language="ruby"]<br />
oauth_token = ClientApplication.find_token(request_proxy.token)<br />
[/sourcecode]</p>
<h2>And that's it!</h2>
<p>You now have a working provider. OauthController handles all the communication with the consumers. OauthClientsController manages the registration of new consumers. They both have customizable views: oauth for the authorization part (for users) and oauth clients for the consumers. And you just need the oauth_required filter to manage access to your data.</p>
<p>And now, you can go to /users/sign_up, then /users/sign_in, then /oauth_clients to register a new client application. You just need to give a name for your application, your URL, and a callback URL.</p>
<p>In the next post, we will build a consumer, and this consumer will access the provider's data.</p>

    

    
      
      
      

      
    
  </article>
  
  <article class="post-body">
    <h2 class="post-title">
      <a href="/development/reinventing%20the%20wheel/security/web/2011/04/01/yet-another-authentication-scheme.html">
        Yet another authentication scheme
      </a>
    </h2>
    <div class="post-meta">
  <span class="post-date">01 Apr 2011</span>
  <span class="post-categories">
    
      &bull;

      
      
      

      
        <a href="/category/development.html">
          Development
        </a>
      
    
      &bull;

      
      
      

      
        Reinventing the wheel
      
    
      &bull;

      
      
      

      
        <a href="/category/security.html">
          Security
        </a>
      
    
      &bull;

      
      
      

      
        Web
      
    
  </span>
</div>

    
      <p>Recently, I was asked to design a new authentication protocol for a web service. I know that I shouldn't do reinvent the wheel, so I immediatly proposed OAUTH.  It turns out that it can't be used in this situation. Here are the constraints:</p>
<p>-calls to the webservice must be authenticated: I can keep the tokens and signature from OAUTH here. The problem is: how do I get that token?</p>
<p>-calls are made from devices or applications without access to a webbrowser (embedded devices, phones, etc.). The redirection dance of OAUTH is not acceptable here</p>
<p>-communications are done over an untrusted network, without SSL.</p>
<p>-I can't use application keys and secrets to encrypt and sign the authentication process: clients include open source software and smartphone applications. You can't hide a secret key in these.</p>
<p>-the protocol has to be simple to implement, on a lot of languages</p>
<p>-the server must not store the password in cleartext (I shouldn't have to precise this...), the client must not store the password</p>
<p>Summing it up: no preshared keys, no browser, no SSL, untrusted networks, no passwords stored, and an OAUTH-like environment once the client is authenticated (tokens, authorizations, revoking, etc)</p>
<p>Apparently, I should just give up. But I like to play, so I'll try!</p>
<p>First, I must say that I am not an expert in security nor cryptography. But I'm really enthusiastic about these subjects, and my day job is at a company providing strong authentication solutions (no, this protocol is not related to my day job). So, I know a bit about the subject, and I know that I should ask for reviews, hence this post.</p>
<h2>Rough ideas</h2>
<p>We need a safe communication over an untrusted network. TLS immediatly comes to mind, but the targeted applications might not have access to a TLS implementation. I'd like to use SRP, but I don't think I'm able to implement it correctly (and it has to be SIMPLE). Using Diffie-Hellman to establish a shared key is another idea, but it is not safe against MITM.</p>
<p>Here's my idea: we don't need to generate a shared secret, we already have it. It's the password!</p>
<p>But how can I use the password if the server doesn't store it in cleartext?</p>
<h2>The trick: key derivation functions</h2>
<p>Decveoplers are finally understanding that they should not use MD5 nor SHA1 to store their passwords, even with a salt, because computing power is so cheap these days that anyone could crack easily a lot of passwords.</p>
<p>It is now recommended to use other functrions tro store passwords. The key derivation functions are a class of functions that create a key from a password. Basically, they do it by interating a lot of times. That makes them very slow, which is an interesting property if you want to stpre passwords: it is too expensive to "crack" the password. PBKDF2, bcrypt and scrypt are well known  key derivation functions. They're simple to use and available in a lot of languages.</p>
<p>With these functions, I can safely store the passwords, and generate a key shared with the client.</p>
<p>In short: if I store kdf(password, N) with N the number of iterations, I can send any M &gt; N to the client and ask him to compute the key, without compromising what I store.</p>
<h2>Designing the protocol</h2>
<p>Now that we have a way to use a shared key, we can look at what will go over the wire to establish it. If I use directly kdf(pass, M), anybody getting access to the client storage will be able to obtain the key for any L &gt; M. So, the key establishment has to use a nonce. That way, the client will only use the password once and forget it, and store the derivated key.</p>
<p>I would rather use a truly random key that has no relation with the password. It could be given to the client, encrypted with the derivated key. The derivated key could then be thrown away. But I still do not know if it is really necesary.</p>
<p>The server still needs to authenticate the client. The client will make a second call to the web service, signing it with HMAC and the key.</p>
<p>That's it! It is really simple, so if there are flaws I did not see, you will surely catch them.</p>
<h2>TL; DR</h2>
<p>The protocol is based on key derivation functions, like PBKDF or bcrypt.</p>
<ul>
<li>The server stores login and H = kdf(pass, N), with N integer</li>
<li>The client wants to authenticate and makes a call to the server with the login as argument</li>
<li>The server replies with M &gt; N and i nonce</li>
<li>The client calculates k1 = kdf(kdf(pass, M)+i, 1)</li>
<li>The server calculates k2 = kdf(kdf(H, M-N)+i, 1)</li>
<li>The client calls the server with args "user=login&amp;sign=".HMAC("user=login", k2)</li>
<li>If k1=k2. The signature matches and the client is authenticated.</li>
</ul>

    

    
      
      
      

      
    
  </article>
  
  <article class="post-body">
    <h2 class="post-title">
      <a href="/development/general/2011/02/18/the-geal-test-extending-the-joel-test.html">
        The Geal test: extending the Joel Test
      </a>
    </h2>
    <div class="post-meta">
  <span class="post-date">18 Feb 2011</span>
  <span class="post-categories">
    
      &bull;

      
      
      

      
        <a href="/category/development.html">
          Development
        </a>
      
    
      &bull;

      
      
      

      
        General
      
    
  </span>
</div>

    
      <p>The <a title="Joel on software - the Joel test" href="http://www.joelonsoftware.com/articles/fog0000000043.html" target="_blank">Joel test</a> was written by Joel Spolsky to provide a few very simple questions for developers to ask in an interview. Here they are:</p>
<blockquote><p><strong>The Joel Test</strong></p>
<ol>
<li>Do you use source control?</li>
<li>Can you make a build in one step?</li>
<li>Do you make daily builds?</li>
<li>Do you have a bug database?</li>
<li>Do you fix bugs before writing new code?</li>
<li>Do you have an up-to-date schedule?</li>
<li>Do you have a spec?</li>
<li>Do programmers have quiet working conditions?</li>
<li>Do you use the best tools money can buy?</li>
<li>Do you have testers?</li>
<li>Do new candidates write code during their interview?</li>
<li>Do you do hallway usability testing?</li>
</ol>
</blockquote>
<p>They seem basic, and that's the point: a company with a poor score doesn't give a nice environment to its developers.</p>
<p>While this test is still applicable, it was written in 2000, and software development has seen a lot of changes and innovation. So, I thought of a few other questions that you can ask your current or future employer:</p>
<blockquote><p><strong>The Geal Test</strong></p>
<ol>
<li>Do you use agile development methods?</li>
<li>Do you have unit tests?</li>
<li>Do you perform code reviews?</li>
<li>Do you use known technologies and frameworks (open source or not)?</li>
<li>Do developers train and learn on office hours, or in their spare time?</li>
<li>Do developers communicate with system administrators (deployment requests and bug reports don't count)?</li>
<li>Do developers communicate with the client?</li>
<li>Do developers retain copyright on the work done in their spare time?</li>
</ol>
</blockquote>
<p>That's it, 8 more questions, 1 point by positive answer.  Joel said that 11 or 12 for his test is ok. I'm nicer, so I'll say that 6 on my test is good enough.</p>
<h2>1. Do you use agile development methods?</h2>
<p>Agile methods have been there for a few years now, and they have proven useful for a lot of projects, especially when you have changing requirements or a very short time to market. Don't let your developers fight everyday against specifications written 5 years ago, let them adapt on the way.</p>
<h2>2. Do you have unit tests?</h2>
<p>This should be standard. There are a lot of libraries to write tests in every language, for specific functions, for APIs, for user interfaces, so this approach is well supported. Moreover, if you answered "yes" to Joel's question about daily builds, you can add tests to the loop, and run them right after the daily build. If you're not convinced about the usefulness of unit tests, or fear that it will take too much time: unit tests give you assurance that you won't break the code, they can validate the compliance with the specifications, and automated unit tests will save some time for development. You don't want to pay a developer to test manually over and over the same code, but you can buy a machine to do that.</p>
<h2>3. Do you perform code reviews?</h2>
<p>I know that this one is hard to implement in a team, but once the developers are past the "I'm too shy to show you my code" phase, this will help them spot mistakes, learn from the better developers and find new ways to improve the code.</p>
<h2>4. Do you use known technologies and frameworks (open source or not)?</h2>
<p>A lot of companies have custom frameworks that they develop and use for their products, that nobody else uses. Although it can be comforting to have your own technology, that you control and maintain, it has a few problems:</p>
<ul>
<li>it reeks of <a title="Not Invented Here" href="http://en.wikipedia.org/wiki/Not_Invented_Here" target="_blank">NIH syndrome</a></li>
<li>it is a cost not directly linked to what you're selling</li>
<li>you have to train developers to use it</li>
<li>the expertise they build will be useless in future jobs</li>
</ul>
<p>If you use known (and hopefully, recent) technologies, you don't have to maintain it (although you may need to pay for it), you profit from bugfixes for other clients, and you are more likely to attract and hire skilled developers. Seriously, I don't want to waste years to maintain your dead framework.</p>
<h2>5. Do developers train and learn on office hours, or in their spare time?</h2>
<p>Software development moves very fast and a developer needs to catch up often. If you don't allocate time in his schedule to read, try and learn, you can still assume that he will still train himself in his spare time. But you take the risk that your Java developer becomes a Ruby expert, because he will learn what he wants, not what you need. If you want your developers to become experts, help them.</p>
<h2>6. Do developers communicate with system administrators (deployment requests and bug reports don't count)?</h2>
<p>Too often, the only communication between developers and tech ops is through deployment request and bug reports. The consequence: they don't know each other, they don't trust each other, and when there's a problem, they don't work together. Obviously, this is not a good work environment. As a developer, I'm interested in how my code behaves in real conditions, and I would like helpful bug reports, instead of "it doesn't work, I rollback", and knowing and working with the sys admins can provide it.</p>
<h2>7. Do developers communicate with the client?</h2>
<p>Ok, this one will horrify some project managers and a few developers. I know that you want  to control all the interactions with the client, and that developers sometimes have poor communication skills. But if you put a few layers between the developer and the client, this is what the developer will see: specifications that don't make sense, and useless bug reports. Developers are problem analysis machines, so they can understand the needs of your client, and see right away what is implied in architecture, technology and performance. Use their insight, and they will feel useful, and produce better software. Also, if you can, send a developer to watch a  bit how the client works with the software. In 5 minutes, they will spot more bugs and usability problems than in 5 weeks of bug reports.</p>
<h2>8. Do developers retain copyright on the work done in their spare time?</h2>
<p>When you're passionate about development, you often have ideas, itches to scratch, and you may not be able to develop them at work. But a lot of contracts have non competition clauses and other clauses giving copyright of ALL your work to the employer. As an employer, it's a way to protect the company, but as a developer, it is scary: you can't use or sell the code written in your spare time. Let your developers work on what they want when they're not in the office, and you will profit from the experience they gained developing their side projects (but state clearly that they work for you on office hours).</p>
<h2>Bonus</h2>
<p>I also have 4 bonus questions. They're optional, but they don't hurt.</p>
<ul>
<li>Do the developers participate in &lt;LANGUAGE&gt; user groups or developer meetups? In these meetups, they will learn a lot, and if they're experts and enjoy working for you, they will attract other developers.</li>
<li>Will I have a technical manager? It is reassuring for a developer to know that his manager has a clue about development, knows the difference between a good and a bad developer, can understand his problems and stabd up for his team.</li>
<li>Do you use a recent version control software? Joel already asked this, but it needs to be precised. Version control systems have improved a lot since his test so, if you can, avoid old stuff like CVS or (worse) SourceSafe. Subversion is fine for most setups now (even on <a title="TortoiseSVN" href="http://tortoisesvn.net/" target="_blank">Windows</a>), and if you use Git or Mercurial, I will be reaaaally happy.</li>
<li>Do you accept remote working? There are a lot of tools to communicate online: mail, IM, VoIP, web project managers and bug trackers, and developers often know very well how to use them. It's comforting for the employer to know that the developer is always at arm's length, but this will not mean they're more productive. If you remove distractions from the work environment (phone, colleagues), the developer can be more productive (yes, there are actually LESS distractions at home). Also, they won't waste time in transport.</li>
</ul>
<p>Now, if you're a developer, rate your own company or future job. If you're a manager, rate your team, and please, please, on behalf of all the developers out there, try to get the perfect score!</p>
<p>How much did you get?</p>

    

    
      
      
      

      
    
  </article>
  
  <article class="post-body">
    <h2 class="post-title">
      <a href="/smalltalk/2011/02/04/smalltalk-for-engineers.html">
        Smalltalk for engineers
      </a>
    </h2>
    <div class="post-meta">
  <span class="post-date">04 Feb 2011</span>
  <span class="post-categories">
    
      &bull;

      
      
      

      
        Smalltalk
      
    
  </span>
</div>

    
      <p>For more than a year, I have been playing with Smalltalk, and more specifically the <a title="Pharo, an open source Smalltalk" href="http://pharo-project.org" target="_blank">Pharo project</a>, and I had a lot of fun! Now, I'd like to share this experience. I saw a lot of introductions to Smalltalk, but they were all about its amazing features from a CS point of vue. I'm a software engineer, so I'll give you a more pragmatic look, with a few useful tips.</p>
<p>When you hear about Smalltalk, you imagine old bearded guys, clinging to their outdated language. In reality, this is what I saw: a small yet growing community full of nice and motivated people, enjoying development and innovating everyday. Even if the language is old, they're keeping it up to date with today's standards: JIT compiling, web development, iPhone port... I strongly encourage you to take a look and, maybe, participate!</p>
<h2>First look: the interface</h2>
<p>The first impression is the most shocking: you don't understand what you can/should do with that empty window. It is not the code editor you would expect. It is an entire world, full of living objects. The behaviour of these objects is described by code, but they're not programs with a beginning and an end. For a good impression of that, try closing the environment (don't forget to save) and starting it again: your windows are still open, exactly in the same place! Even selected text is still there! Your object's life doesn't end when you close the environment: they're serialized in the image file.</p>
<p><img class="aligncenter size-medium wp-image-164" title="pharo-firstscreen" src="/assets/pharo-firstscreen.jpg?w=300" alt="" width="300" height="205" /></p>
<p>The environment is composed of a virtual machine executing the code, an image file containing the objects, and a source file, storing a part of the source code. And that's all. No files.</p>
<p><strong>UPDATE: </strong>the <a href="http://smalltalk.gnu.org/" target="_blank">GNU Smalltalk</a> environment uses files to store source code.</p>
<p>In the previous picture, you will see the code browser, used for everyday development. It doesn't display files, but (from left to right) categories, classes, method categories, methods, and under that, the actual code for the method. The code editor is organized around the actual structure of the code, not some arbitrary folder tree. It can be confusing at first, but it's actually quite elegant. There's a drawback though: you can't use your favorite code editor to write Smalltalk code. Another nice side effect of the image: I store my environment on a USB key, and can use it to work seamlessly on Windows, Mac and Linux (using the <a title="Download the one click pharo image" href="http://gforge.inria.fr/frs/download.php/28015/Pharo-1.1.1-OneClick.zip">one click pharo image</a>).</p>
<h2>Second look: the language</h2>
<p>The language itself is another surprise: what are those ifTrue and whileTrue? You can't think that Smalltalk has a syntax used for control flow.  In Smalltalk, everything is an object. And the primary way of interacting with an object is sending it a message. The whole syntax of Smalltalk revolves around messages:</p>
<ul>
<li>"1+2/3" is not equal to 5/3, but to 1, because you send to 1 the message "+" with argument 2, which gives you 3, and you send this result the message "/" with argument 3.</li>
<li>ifTrue is a message sent to a boolean, with a "block" as argument (a block is a piece of code). The block will be executed if the boolean is an instance of True.</li>
<li>you can't access directly the members of an object: you need to create messages to read and modify these members.</li>
</ul>
<p>The methods are separated between the class side and the instance side. The classes are objects, so they have their own methods (think of it as static methods). They're used for a lot of things, like generating common instances (String crlf, Color blue, etc), or starting servers.</p>
<p>If you take a good look at a class like string, you will spot apparently redundant methods like displayOn:, displayOn:at:, displayAt:, displayOn:at:textColor:. They're not redundant: displayOn calls displayOn:at:, which calls displayOn:at:textColor:. This is actually very elegant, because it keeps methods small and readable.</p>
<p>Keep that in mind when you're developing in Smalltalk: readability is more important that speed, because the time you gain now will be wasted the next time you try to read your code.</p>
<h2>Next: the tools</h2>
<p>You saw the code browser, but there are other nice tools designed to help you every day.</p>
<p>Monticello is a distributed versioning system integrated in the environment. Nothing special here: it tracks your changes, create revisions, and supports local (folders) and remote (HTTP, FTP) repositories.</p>
<p>There is a test runner that displays all the tests loaded in your environment. You will see that there is a very good coverage, but it is not enough! Contribute a test or two if you have time.</p>
<p>Last but not least: the refactoring browser. It is an amazing piece of code which analyzes your classes, points out design mistakes, and in some cases, can correct them in your place.</p>
<h2>OK, now, what can I develop?</h2>
<p>You can do about anything in Smalltalk, like other languages: desktop applications, web applications, use databases, network protocols, REST APIs... It is particularly suited for big applications with complex object models.</p>
<p>For desktop applications, you will easily have cross platform code and UI, but you won't be able to use native windows (at least, not with Squeak or Pharo). For web applications, you can choose between these frameworks: <a href="http://www.seaside.st">Seaside</a>, <a href="http://www.iliadproject.org">Iliad</a> and <a href="http://www.aidaweb.si/">Aida</a>. Each one has a different philosophy, and different strengths, so try them all out!</p>
<p>Developing in Smalltalk has been an amazing experience: I learned a lot, and the concepts and habits I took are easily applied to other languages. now, I just need a way to work in Smalltalk for my day job :)</p>

    

    
      
      
      

      
    
  </article>
  

  
<div class="pagination">
  <a class="pagination-item older"
     href="/page10">
    Older
  </a>
</div>


</div>
    </main>

    <!-- Optional footer content -->

  </body>
</html>
