<!DOCTYPE html>
<html lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta http-equiv="content-type" content="text/html; charset=utf-8" />

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1" />

  <title>
    
      Unhandled Expression &middot; Geoffroy Couprie – software security and architecture consultant
    
  </title>

  
  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-117988815-1', 'auto');
  ga('send', 'pageview');
  </script>



  <!-- CSS -->
  <link rel="stylesheet" href="/assets/css/main.css" />
  

<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Abril+Fatface" />

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/favicon.png" />
<link rel="shortcut icon" href="/favicon.ico" />

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/feed.xml" />

  <!-- Additional head bits without overriding original head -->
</head>


  <body class="index">

    <div id="sidebar">
  <header>
    <img src="https://s.gravatar.com/avatar/ed9901b9b80743c05aedf58b4f4926dd?s=200" alt="self" />
    <h1 class="site-title">
      <a href="/">
        
          <span class="back-arrow icon"><svg fill="#000000" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
  <path d="M0 0h24v24H0z" fill="none"/>
  <path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/>
</svg></span>
        
        Unhandled Expression
      </a>
    </h1>
    <p class="lead">Geoffroy Couprie – software security and architecture consultant</p>
  </header>
  <nav id="sidebar-nav-links">
  
    <a class="home-link "
        href="/">Home</a>
  
  

  

  


  
    
  

  
    
      <a class="page-link "
          href="/about.html">About</a>
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  


  


  
    
  

  
    
  

  
    
      <a class="category-link "
          href="/category/architecture.html">Architecture</a>
    
  

  
    
      <a class="category-link "
          href="/category/crypto.html">Crypto</a>
    
  

  
    
      <a class="category-link "
          href="/category/development.html">Development</a>
    
  

  
    
  

  

  
    
      <a class="category-link "
          href="/category/rust.html">Rust</a>
    
  

  
    
  

  
    
      <a class="category-link "
          href="/category/security.html">Security</a>
    
  

  
    
  

  
    
      <a class="category-link "
          href="/category/videolan.html">VideoLAN</a>
    
  

  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  


  <!-- Optional additional links to insert in sidebar nav -->
</nav>


  <nav id="sidebar-icon-links">
  

  <a id="subscribe-link"
     class="icon" title="Subscribe" aria-label="Subscribe"
     href="/feed.xml">
    <svg fill="#000000" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
    <path d="M0 0h24v24H0z" fill="none"/>
    <circle cx="6.18" cy="17.82" r="2.18"/>
    <path d="M4 4.44v2.83c7.03 0 12.73 5.7 12.73 12.73h2.83c0-8.59-6.97-15.56-15.56-15.56zm0 5.66v2.83c3.9 0 7.07 3.17 7.07 7.07h2.83c0-5.47-4.43-9.9-9.9-9.9z"/>
</svg>
  </a>

  
  
  
  

  
    <a id="tags-link"
       class="icon"
       title="Tags" aria-label="Tags"
       href="/tags.html">
      <svg fill="#000000" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
    <path d="M0 0h24v24H0z" fill="none"/>
    <path d="M17.63 5.84C17.27 5.33 16.67 5 16 5L5 5.01C3.9 5.01 3 5.9 3 7v10c0 1.1.9 1.99 2 1.99L16 19c.67 0 1.27-.33 1.63-.84L22 12l-4.37-6.16z"/>
</svg>
    </a>
  

  
    <a id="search-link"
       class="icon"
       title="Search" aria-label="Search"
       href="/search.html">
      <svg fill="#000000" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
    <path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/>
    <path d="M0 0h24v24H0z" fill="none"/>
</svg>
    </a>
  

  <!-- Optional additional links to insert for icons links -->
</nav>
  <a class="category-link active" href="https://www.patreon.com/geoffroy">Support my work on Patreon</a>
  <!--<p>
  &copy; 2018.
  <a href="/LICENSE.md">MIT License.</a>
</p>
-->
</div>


    <main class="container">
      <div class="content">
  
<div class="pagination">
  <a class="pagination-item newer"
     href="/page5">
    Newer
  </a>
</div>



  

  
  <article class="post-body">
    <h2 class="post-title">
      <a href="/development/general/2013/03/18/my-ideal-job-post.html">
        My ideal job posting
      </a>
    </h2>
    <div class="post-meta">
  <span class="post-date">18 Mar 2013</span>
  <span class="post-categories">
    
      &bull;

      
      
      

      
        <a href="/category/development.html">
          Development
        </a>
      
    
      &bull;

      
      
      

      
        General
      
    
  </span>
</div>

    
      <p>This post is a translation of <a href="http://blog.humancoders.com/post/44145884680/loffre-demploi-ideale-de-gcouprie" title="L'offre d'emploi idéale de Geoffroy Couprie" target="_blank">something I wrote in French for Human Coders</a>. They asked me what would be the ideal job post from a developer's standpoint:</p>
<p>How whould you write a job announcement attracting good developers? Most recruiters complain that finding the right candidates is an ordeal.</p>
<p>If you ask me, it is due to very old recruitment practices: writing job posts for paper ads (where you pay by the letter), spamming them to as many people as possible, mandating fishy head hunters... This has worked in the past, but things changed. A lot more companies are competing to recruit developers, and many more developers are available, so separating the wheat from the chaff is harder.</p>
<p>We can do better! Let's start from scratch. For most candidates, a job posting is the first contact they'll have with your company. It must be attrctive, exciting! When I read "the company X is the leader on the market of Y", I don't think that they're awesome, I just wonder what they really do.</p>
<p>A job posting is a marketing document. Its purpose is not to filter candidates, but to attract them! And how do you write a marketing document?</p>
<p>YOU. TALK. ABOUT. THE. CLIENT. You talk about his problems, his aspirations, and only then, will you tell him how you will make things better for him. For a job posting, you must do the same. You talk to THE candidate. Not to multiple candidates, not to the head hunter or the HR department, but to the candidate. Talk about the candidate, and only the candidate. When a developer looks for a job, she doesn't want to "work on your backend application" or "maintain the web server". That is what she will do for you. This is what she wants:</p>
<ul>
<li>getting paid to write code</li>
<li>work on interesting technologies</li>
<li>a nice workplace atmosphere</li>
<li>learn</li>
<li>etc.</li>
</ul>
<p>A good job posting should answer the candidate's aspirations, and talk about the career path. Does this job lead to project management? Do you propose in-house training? Is there a career path for expertise in your caompany?</p>
<p>Do you share values with your candidate? I do not mean the values written by your sales team and displayed on the "our values" page of your website. I am talking about the values of the team where the candidate will end up. Do they work in pair programming? Do they apply test driven development? There is no best way to work, the job can be done in many ways, so you must make sure that the candidate will fit right in.</p>
<p>What problem are you trying to solve with your company? Do you create websites that can be managed by anyone? Do you provide secure hosting? Whatever your goal is, talk about it instead of talking about the product. I do not want to read, "our company develops a mobile server monitoring tool", because that is uninteresting. If I read "we spent a lot of time on call for diverse companies, so we understood that mobility is crucial for some system administrators, so we created a tool tailored for moving system administrators", I see a real problem, a motivation to work, a culture that I could identify to.</p>
<p>By talking that way to the candidate, you will filter candidates on motivation and culture instead of filtering on skills. That can be done later, once you see the candidate You did not really think that a resume was a good way to select skilled people, do you?</p>
<p>Here is a good example of fictive job posting, from a company aggregating news for developers, looking for a Rails developer:</p>
<p>"You are a passionnate Ruby on Rails developers, you are proiud of you unit tests, and you enjoy the availability of Heroku's services? That's the same for us!</p>
<blockquote><p>At Company X, we love developers: all of our services are meant for their fulfillment. We propose a news website about various technologies, higly interesting trainings and a job board for startups.</p>
<p>Our employees benefit fully from these services, and make talks in conferences all around France. By directly talking with other developers, they quickly get an extensive knowledge of current technologies.</p>
<p>Our news website is growing fast, so we need help to scale it. The web app uses Heroku and MongoDB, with a CoffeeScript front end. Are you well versed in Rails optimization? If yes, we would love to talk with you!"
</p></blockquote>
<p>Note that I did not talk about years of experience, or a city. I want to hire a Rails developer, not necessarily a french developer. I want someone with experience in optimization, not someone over 27.</p>
<p>With such a job posting, you will receive a lot more interesting employment applications. Now, are you afraid that it will incur a lot more work? The solution in a future post: how to target candidates efficiently? Get away from job boards!</p>

    

    
      
      
      

      
    
  </article>
  
  <article class="post-body">
    <h2 class="post-title">
      <a href="/ruby/security/2013/02/06/filter-rails-json-input-with-route-constraints.html">
        Filter Rails JSON input with route constraints
      </a>
    </h2>
    <div class="post-meta">
  <span class="post-date">06 Feb 2013</span>
  <span class="post-categories">
    
      &bull;

      
      
      

      
        Ruby
      
    
      &bull;

      
      
      

      
        <a href="/category/security.html">
          Security
        </a>
      
    
  </span>
</div>

    
      <p>Following the recent <a title="Vulnerability in JSON Parser in Ruby on Rails 3.0 and 2.3" href="https://groups.google.com/forum/?fromgroups=#!topic/rubyonrails-security/1h2DR63ViGo" target="_blank">YAML parsing vulnerabilities in Rails</a>, I decided to act on an idea I had a few months ago: using route constraints to define strict API contracts in Rails.</p>
<p>Sadly, it does not protect against the YAML parsing problem (and the probable similar vulnerabilities we will see in the following months), because the request is interpreted before going through the route constraints. But it can protect from the <a title="Rails security guide: mass assignment" href="http://guides.rubyonrails.org/security.html#mass-assignment" target="_blank">mass assignment vulnerability</a>., and probably some SQL injections.</p>
<p>Here is the idea: Rails 3 introduced the route constraints, a way to execute fonctions on the request before it is passed to the controllers. By combining it with the json-schema gem, we can filter the JSON input quite easily.</p>
<p>For the following example data:</p>
<p>[sourcecode language="javascript"]<br />
{&quot;echo&quot; : &quot;blah&quot;, &quot;nb&quot; : 1, &quot;data&quot;: [1, 2, 3]}<br />
[/sourcecode]</p>
<p>We can define the following schema:</p>
<p>[sourcecode language="javascript"]<br />
{<br />
    &quot;type&quot;: &quot;object&quot;,<br />
    &quot;$schema&quot;: &quot;http://json-schema.org/draft-03/schema&quot;,<br />
    &quot;id&quot;: &quot;#&quot;,<br />
    &quot;required&quot;: false,<br />
    &quot;additionalProperties&quot;: false,<br />
    &quot;properties&quot;: {<br />
        &quot;data&quot;: {<br />
            &quot;type&quot;: &quot;array&quot;,<br />
            &quot;id&quot;: &quot;data&quot;,<br />
            &quot;required&quot;: false,<br />
            &quot;items&quot;: {<br />
                &quot;type&quot;: &quot;number&quot;,<br />
                &quot;id&quot;: &quot;0&quot;,<br />
                &quot;required&quot;: false<br />
            }<br />
        },<br />
        &quot;echo&quot;: {<br />
            &quot;type&quot;: &quot;string&quot;,<br />
            &quot;id&quot;: &quot;echo&quot;,<br />
            &quot;required&quot;: false<br />
        },<br />
        &quot;nb&quot;: {<br />
            &quot;type&quot;: &quot;number&quot;,<br />
            &quot;id&quot;: &quot;nb&quot;,<br />
            &quot;required&quot;: false<br />
        }<br />
    }<br />
}<br />
[/sourcecode]</p>
<p>(Use the <a title="JSON schema generator" href="http://www.jsonschema.net/" target="_blank">JSON schema generator</a> to create your own)</p>
<p>Save this schema to "data.schema" and add "json-schema" to your Gemfile. You will then be able to filter inputs with code like the following "config/routes.rb":</p>
<p>[sourcecode language="ruby"]<br />
require &quot;json-schema&quot;<br />
class LolJSONConstraint<br />
  def matches?(request)<br />
    if(request.headers[&quot;CONTENT_TYPE&quot;] == &quot;application/json&quot;)<br />
      JSON::Validator.validate(&quot;data.schema&quot;, request.headers[&quot;action_dispatch.request.request_parameters&quot;])<br />
    end<br />
  end<br />
end</p>
<p>Yamlvuln::Application.routes.draw do<br />
  resources :posts, :constraints =&gt; LolJSONConstraint.new<br />
end<br />
[/sourcecode]</p>
<p>The constraint will load the schema, and apply it to the incoming data, and return a 404 error if the JSON is invalid. The "additionalProperties" set to false in the schema is required to refuse the properties you didn't define and protect the application from mass assignment.</p>
<p>If I tried, for example, to send the following JSON to the application, there would be an error:</p>
<p>[sourcecode language="javascript"]<br />
{&quot;echo&quot; : &quot;blah&quot;, &quot;nb&quot; : &quot;UNION ALL SELECT LOAD_FILE(CHAR(34,47,101,116,99,47,112,97,115,115,119,100,34))&quot;, &quot;data&quot;: [1, 2, 3]}<br />
[/sourcecode]</p>
<p>As I said before, it is not safe against the YAML parsing vulnerability. Also, I did not really test the performance of this. But it is still a nice and easy solution for API filtering.</p>

    

    
      
      
      

      
    
  </article>
  
  <article class="post-body">
    <h2 class="post-title">
      <a href="/development/security/2013/01/30/looking-for-big-architectures-and-adventurous-sysadmins.html">
        Looking for big architectures and adventurous sysadmins
      </a>
    </h2>
    <div class="post-meta">
  <span class="post-date">30 Jan 2013</span>
  <span class="post-categories">
    
      &bull;

      
      
      

      
        <a href="/category/development.html">
          Development
        </a>
      
    
      &bull;

      
      
      

      
        <a href="/category/security.html">
          Security
        </a>
      
    
  </span>
</div>

    
      <p>Last week, I wrote <a title="5 easy tips to accelerate SSL" href="http://unhandledexpression.com/2013/01/25/5-easy-tips-to-accelerate-ssl/" target="_blank">a post about SSL optimization</a> that showed the big interest people have in getting the absolute best performance from their web servers.</p>
<p>That post was just a small part of <a title="SSL: what you need to know" href="http://leanpub.com/SSL" target="_blank">the ebook on SSL tuning</a> I am currently writing. This ebook will cover various subjects:</p>
<ul>
<li>algorithms comparison</li>
<li>handshake tuning</li>
<li>HSTS</li>
<li>session tickets</li>
<li>load balancers</li>
<li>...</li>
</ul>
<p>I test a lot of different architectures, to provide you with tips directly adaptable to your system (like I did previously with Apache and Nginx). But I don't have access to every system under the sun...</p>
<p>So, if you feel adventurous enough to try SSL optimization on your servers, <a href="http://geoffroycouprie.com/" target="_blank">please contact me</a>, I would be happy to help you!</p>
<p>I am especially interested in large architectures (servers in multiple datacenters around the world, large load balancers, CDNs) and mobile application backends.</p>
<p>And don't forget to <a title="SSL: what you need to know" href="http://leanpub.com/SSL" target="_blank">check out the ebook, to be notified about updates!</a></p>

    

    
      
      
      

      
    
  </article>
  
  <article class="post-body">
    <h2 class="post-title">
      <a href="/development/general/security/2013/01/25/5-easy-tips-to-accelerate-ssl.html">
        5 easy tips to accelerate SSL
      </a>
    </h2>
    <div class="post-meta">
  <span class="post-date">25 Jan 2013</span>
  <span class="post-categories">
    
      &bull;

      
      
      

      
        <a href="/category/development.html">
          Development
        </a>
      
    
      &bull;

      
      
      

      
        General
      
    
      &bull;

      
      
      

      
        <a href="/category/security.html">
          Security
        </a>
      
    
  </span>
</div>

    
      <p style="text-align:center;"><img class=" wp-image-558 aligncenter" title="Photo credit: TheKenChan - http://www.flickr.com/photos/67936989@N00/2678539087/" alt="Photo credit: TheKenChan - http://www.flickr.com/photos/67936989@N00/2678539087/" src="/assets/2678539087_afdb3ec75a.jpg" width="500" height="333" /></p>
<p><strong>Update</strong>: following popular demand, the article now includes nginx commands :)</p>
<p><strong>Update 2</strong>: thanks to jackalope from Hacker News, I added a missing Apache directive for the cipher suites.</p>
<p><strong>Update 3</strong>: recent attacks on RC4 have definitely made it a bad choice, and ECDHE cipher suites got improvements.</p>
<p>SSL is slow. These cryptographic algorithms eat the CPU, there is too much traffic, it is too hard to deploy correctly. SSL is slow. Isn't it?</p>
<p>HELL NO!</p>
<p>SSL looks slow, because you did not even try to optimize it! For that matter, I could say that HTTP is too verbose, XML web services are verbose too, and all this traffic makes the website slow. But, SSL can be optimized, as well as everything!</p>
<h2>Slow cryptographic algorithms</h2>
<p>The cryptographic algorithms used in SSL are not all created equal: some provide better security, some are faster. So, you should choose carefully which algorithm suite you will use.</p>
<p>The default one for Apache 2's <a href="http://httpd.apache.org/docs/2.2/mod/mod_ssl.html#sslciphersuite" target="_blank">SSLCipherSuite directive</a> is: ALL: !ADH:RC4+RSA:+HIGH:+MEDIUM:+LOW:+SSLv2:+EXP</p>
<p>You can translate that to a readable list of algorithms with this command: <strong>openssl ciphers -v 'ALL:!ADH:RC4+RSA:+HIGH:+MEDIUM:+LOW:+SSLv2:+EXP'</strong></p>
<p>Here is the result:</p>
<pre>DHE-RSA-AES256-SHA      SSLv3 Kx=DH       Au=RSA  Enc=AES(256)  Mac=SHA1
DHE-DSS-AES256-SHA      SSLv3 Kx=DH       Au=DSS  Enc=AES(256)  Mac=SHA1
AES256-SHA              SSLv3 Kx=RSA      Au=RSA  Enc=AES(256)  Mac=SHA1
DHE-RSA-AES128-SHA      SSLv3 Kx=DH       Au=RSA  Enc=AES(128)  Mac=SHA1
DHE-DSS-AES128-SHA      SSLv3 Kx=DH       Au=DSS  Enc=AES(128)  Mac=SHA1
AES128-SHA              SSLv3 Kx=RSA      Au=RSA  Enc=AES(128)  Mac=SHA1
EDH-RSA-DES-CBC3-SHA    SSLv3 Kx=DH       Au=RSA  Enc=3DES(168) Mac=SHA1
EDH-DSS-DES-CBC3-SHA    SSLv3 Kx=DH       Au=DSS  Enc=3DES(168) Mac=SHA1
DES-CBC3-SHA            SSLv3 Kx=RSA      Au=RSA  Enc=3DES(168) Mac=SHA1
DHE-RSA-SEED-SHA        SSLv3 Kx=DH       Au=RSA  Enc=SEED(128) Mac=SHA1
DHE-DSS-SEED-SHA        SSLv3 Kx=DH       Au=DSS  Enc=SEED(128) Mac=SHA1
SEED-SHA                SSLv3 Kx=RSA      Au=RSA  Enc=SEED(128) Mac=SHA1
RC4-SHA                 SSLv3 Kx=RSA      Au=RSA  Enc=RC4(128)  Mac=SHA1
RC4-MD5                 SSLv3 Kx=RSA      Au=RSA  Enc=RC4(128)  Mac=MD5 
EDH-RSA-DES-CBC-SHA     SSLv3 Kx=DH       Au=RSA  Enc=DES(56)   Mac=SHA1
EDH-DSS-DES-CBC-SHA     SSLv3 Kx=DH       Au=DSS  Enc=DES(56)   Mac=SHA1
DES-CBC-SHA             SSLv3 Kx=RSA      Au=RSA  Enc=DES(56)   Mac=SHA1
DES-CBC3-MD5            SSLv2 Kx=RSA      Au=RSA  Enc=3DES(168) Mac=MD5 
RC2-CBC-MD5             SSLv2 Kx=RSA      Au=RSA  Enc=RC2(128)  Mac=MD5 
RC4-MD5                 SSLv2 Kx=RSA      Au=RSA  Enc=RC4(128)  Mac=MD5 
DES-CBC-MD5             SSLv2 Kx=RSA      Au=RSA  Enc=DES(56)   Mac=MD5 
EXP-EDH-RSA-DES-CBC-SHA SSLv3 Kx=DH(512)  Au=RSA  Enc=DES(40)   Mac=SHA1 export
EXP-EDH-DSS-DES-CBC-SHA SSLv3 Kx=DH(512)  Au=DSS  Enc=DES(40)   Mac=SHA1 export
EXP-DES-CBC-SHA         SSLv3 Kx=RSA(512) Au=RSA  Enc=DES(40)   Mac=SHA1 export
EXP-RC2-CBC-MD5         SSLv3 Kx=RSA(512) Au=RSA  Enc=RC2(40)   Mac=MD5  export
EXP-RC4-MD5             SSLv3 Kx=RSA(512) Au=RSA  Enc=RC4(40)   Mac=MD5  export
EXP-RC2-CBC-MD5         SSLv2 Kx=RSA(512) Au=RSA  Enc=RC2(40)   Mac=MD5  export
EXP-RC4-MD5             SSLv2 Kx=RSA(512) Au=RSA  Enc=RC4(40)   Mac=MD5  export</pre>
<p>28 cipher suites, that's a lot! Let's see if we can remove the unsafe ones first! You can see at the end of the of the list 7 ones marked as "export". That means that they comply with the US cryptographic algorithm exportation policy. Those algorithms are utterly unsafe, and the US abandoned this restriction years ago, so let's remove them:<br />
'ALL:!ADH:!EXP:RC4+RSA:+HIGH:+MEDIUM:+LOW:+SSLv2'.</p>
<p>Now, let's remove the algorithms using plain DES (not 3DES) and RC2: 'ALL:!ADH:!EXP:!LOW:!RC2:RC4+RSA:+HIGH:+MEDIUM'. That leaves us with 16 algorithms.</p>
<p>It is time to remove the slow algorithms! To decide, let's use the <strong>openssl speed</strong> command. Use it on your server, ecause depending on your hardware, you might get different results. Here is the benchmark on my computer:</p>
<pre>OpenSSL 0.9.8r 8 Feb 2011
built on: Jun 22 2012
options:bn(64,64) md2(int) rc4(ptr,char) des(idx,cisc,16,int) aes(partial) blowfish(ptr2) 
compiler: -arch x86_64 -fmessage-length=0 -pipe -Wno-trigraphs -fpascal-strings -fasm-blocks
  -O3 -D_REENTRANT -DDSO_DLFCN -DHAVE_DLFCN_H -DL_ENDIAN -DMD32_REG_T=int -DOPENSSL_NO_IDEA
  -DOPENSSL_PIC -DOPENSSL_THREADS -DZLIB -mmacosx-version-min=10.6
available timing options: TIMEB USE_TOD HZ=100 [sysconf value]
timing function used: getrusage
The 'numbers' are in 1000s of bytes per second processed.
type             16 bytes     64 bytes    256 bytes   1024 bytes   8192 bytes
md2               2385.73k     4960.60k     6784.54k     7479.39k     7709.04k
mdc2              8978.56k    10020.07k    10327.11k    10363.30k    10382.92k
md4              32786.07k   106466.60k   284815.49k   485957.41k   614100.76k
md5              26936.00k    84091.54k   210543.56k   337615.92k   411102.49k
hmac(md5)        30481.77k    90920.53k   220409.04k   343875.41k   412797.88k
sha1             26321.00k    78241.24k   183521.48k   274885.43k   322359.86k
rmd160           23556.35k    66067.36k   143513.89k   203517.79k   231921.09k
rc4             253076.74k   278841.16k   286491.29k   287414.31k   288675.67k
des cbc          48198.17k    49862.61k    50248.52k    50521.69k    50241.28k
des ede3         18895.61k    19383.95k    19472.94k    19470.03k    19414.27k
idea cbc             0.00         0.00         0.00         0.00         0.00 
seed cbc         45698.00k    46178.57k    46041.10k    47332.45k    50548.99k
rc2 cbc          22812.67k    24010.85k    24559.82k    21768.43k    23347.22k
rc5-32/12 cbc   116089.40k   138989.89k   134793.49k   136996.33k   133077.51k
blowfish cbc     65057.64k    68305.24k    72978.75k    70045.37k    71121.64k
cast cbc         48152.49k    51153.19k    51271.61k    51292.70k    47460.88k
aes-128 cbc      99379.58k   103025.53k   103889.18k   104316.39k    97687.94k
aes-192 cbc      82578.60k    85445.04k    85346.23k    84017.31k    87399.06k
aes-256 cbc      70284.17k    72738.06k    73792.20k    74727.31k    75279.22k
camellia-128 cbc        0.00         0.00         0.00         0.00         0.00 
camellia-192 cbc        0.00         0.00         0.00         0.00         0.00 
camellia-256 cbc        0.00         0.00         0.00         0.00         0.00 
sha256           17666.16k    42231.88k    76349.86k    96032.53k   103676.18k
sha512           13047.28k    51985.74k    91311.50k   135024.42k   158613.53k
aes-128 ige      93058.08k    98123.91k    96833.55k    99210.74k   100863.22k
aes-192 ige      76895.61k    84041.67k    78274.36k    79460.06k    77789.76k
aes-256 ige      68410.22k    71244.81k    69274.51k    67296.59k    68206.06k
                  sign    verify    sign/s verify/s
rsa  512 bits 0.000480s 0.000040s   2081.2  24877.7
rsa 1024 bits 0.002322s 0.000111s    430.6   9013.4
rsa 2048 bits 0.014092s 0.000372s     71.0   2686.6
rsa 4096 bits 0.089189s 0.001297s     11.2    771.2
                  sign    verify    sign/s verify/s
dsa  512 bits 0.000432s 0.000458s   2314.5   2181.2
dsa 1024 bits 0.001153s 0.001390s    867.6    719.4
dsa 2048 bits 0.003700s 0.004568s    270.3    218.9</pre>
<p>We can remove the SEED and 3DES suite because they are slower than the other. DES was meant to be fast in hardware implementations, but slow in software, so 3DES (which runs DES three times) is slower. On the contrary, AES can be very fast in software implementations, and even more if your CPU provides specific instructions for AES. You can see that with a bigger key (and so, better theoretical security), AES gets slower. Depending on the level of security, you may choose different key sizes. According to the <a title="Key length comparison" href="http://www.keylength.com" target="_blank">key length comparison</a>, 128 might be enough for now. RC4 is a lot faster than other algorithms. <del>AES is considered safer, but <a href="http://crypto.stackexchange.com/questions/853/google-is-using-rc4-but-isnt-rc4-considered-unsafe" target="_blank">the implementation in SSL takes into account the attacks on RC4</a>. So, we will propose this one in priority.</del> Following recent researches, it appears that RC4 is not safe enough anymore. And ECDHE got a performance boost with recent versions of OpenSSL. So, let's forbid RC4 right now!</p>
<p>So, here is the new cipher suite: 'ALL:!ADH:!EXP:!LOW:!RC2:!3DES:!SEED:!RC4:+HIGH:+MEDIUM'</p>
<p>And the list of ciphers we will use:</p>
<pre>DHE-RSA-AES256-SHA      SSLv3 Kx=DH       Au=RSA  Enc=AES(256)  Mac=SHA1
DHE-DSS-AES256-SHA      SSLv3 Kx=DH       Au=DSS  Enc=AES(256)  Mac=SHA1
AES256-SHA              SSLv3 Kx=RSA      Au=RSA  Enc=AES(256)  Mac=SHA1
DHE-RSA-AES128-SHA      SSLv3 Kx=DH       Au=RSA  Enc=AES(128)  Mac=SHA1
DHE-DSS-AES128-SHA      SSLv3 Kx=DH       Au=DSS  Enc=AES(128)  Mac=SHA1
AES128-SHA              SSLv3 Kx=RSA      Au=RSA  Enc=AES(128)  Mac=SHA1
RC4-SHA                 SSLv3 Kx=RSA      Au=RSA  Enc=RC4(128)  Mac=SHA1
RC4-MD5                 SSLv3 Kx=RSA      Au=RSA  Enc=RC4(128)  Mac=MD5 
RC4-MD5                 SSLv2 Kx=RSA      Au=RSA  Enc=RC4(128)  Mac=MD5</pre>
<p>9 ciphers, that's much more manageable. We could reduce the list further, but it is already in a good shape for security and speed. <strong>Configure it in Apache with this directive</strong>:</p>
<pre><strong></strong><code>SSLHonorCipherOrder On</code><strong></strong>
SSLCipherSuite ALL:!ADH:!EXP:!LOW:!RC2:!3DES:!SEED:!RC4:+HIGH:+MEDIUM</pre>
<p><strong>Configure it in Nginx with this directive:</strong></p>
<pre>ssl_ciphers ALL:!ADH:!EXP:!LOW:!RC2:!3DES:!SEED:!RC4:+HIGH:+MEDIUM</pre>
<p>You can also see that the performance of RSA gets worse with key size. With the current security requirements (as of now, January 2013, if you are reading this from the future). <strong>You should choose a RSA key of 2048 bits for your certificate</strong>, because 1024 is not enough anymore, but 4096 is a bit overkill.</p>
<p>Remember, the benchmark depends on the version of OpenSSL, the compilation options and your CPU, so don't forget to test on your server before implementing my recommandations.</p>
<h2>Take care of the handshake</h2>
<p>The SSL protocol is in fact two protocols (well, three, but the first is not interesting for us): the handshake protocol, where the client and the server will verify each other's identity, and the record protocol where data is exchanged.</p>
<p>Here is a representation of the handshake protocol, taken from the <a title="RFC 2246 for TLS 1.0" href="http://tools.ietf.org/html/rfc2246" target="_blank">TLS 1.0 RFC</a>:</p>
<pre>      Client                                               Server

      ClientHello                  --------&gt;
                                                      ServerHello
                                                     Certificate*
                                               ServerKeyExchange*
                                              CertificateRequest*
                                   &lt;--------      ServerHelloDone
      Certificate*
      ClientKeyExchange
      CertificateVerify*
      [ChangeCipherSpec]
      Finished                     --------&gt;
                                               [ChangeCipherSpec]
                                   &lt;--------             Finished
      Application Data             &lt;-------&gt;     Application Data</pre>
<p>You can see that there are 4 messages exchanged before any real data is sent. If a TCP packet takes 100ms to travel between the browser and your server, the handshake is eating 400ms before the server has sent any data!</p>
<p>And what happens if you make multiple connections to the same server? You do the handshake every time. So, <strong>you should activate Keep-Alive</strong>. The benefits are even bigger than for plain unencrypted HTTP.</p>
<p>Use <a title="KeepAlive" href="http://httpd.apache.org/docs/2.2/mod/core.html#keepalive" target="_blank">this Apache directive</a> to activate Keep-Alive:</p>
<pre>KeepAlive On</pre>
<p>Use <a href="http://wiki.nginx.org/HttpCoreModule#keepalive_timeout" target="_blank">this nginx directive</a> to activate keep-alive:</p>
<pre><b>keepalive_timeout</b> 100</pre>
<h2>Present all the intermediate certification authorities in the handshake</h2>
<p>During the handshake, the client will verify that the web server's certificate is signed by a trusted certification authority. Most of the time, there is one or more intermediate certification authority between the web server and the trusted CA. If the browser doesn't know the intermediate CA, it must look for it and download it. The download URL for the intermediate CA is usually stored in the "Authority information" extension of the certificate, so the browser will find it even if the web server doesn't present the intermediate CA.</p>
<p>This means that if the server doesn't present the intermediate CA certificates, the browser will block the handshake until it has downloaded them and verified that they are valid.</p>
<p>So, if you have intermediate CAs for your server's certificate, configure your webserver to present the full certification chain. With Apache, you just need to concatenate the CA certificates, and indicate them in the configuration with <a href="http://httpd.apache.org/docs/2.2/mod/mod_ssl.html#sslcertificatechainfile" target="_blank">this directive</a>:</p>
<pre>SSLCertificateChainFile /path/to/certification/chain.pem</pre>
<p>For nginx, concatenate the CA certificate to the web server certificate and use <a href="http://wiki.nginx.org/HttpSslModule#ssl_certificate" target="_blank">this directive</a>:</p>
<pre>ssl_certificate /path/to/certification/chain.pem</pre>
<h2>Activate caching for static assets</h2>
<p>By default, the browsers will not cache content served over SSL, for security. That means that your static assets (Javascript, CSS, pictures) will be reloaded on every call. Here is a big performance failure!</p>
<p>The fix for that: <strong>set the HTTP header "Cache-Control: public" for the static assets</strong>. That way, the browser will cache them. But don't activate it for the sensitive content, beacuase it should not be cached on the disk by your browser.</p>
<p><strong>You can use this directive to enable Cache-Control</strong>:</p>
<pre>&lt;filesMatch ".(js|css|png|jpeg|jpg|gif|ico|swf|flv|pdf|zip)$"&gt;
Header set Cache-Control "max-age=31536000, public"
&lt;/filesMatch&gt;</pre>
<p>The files will be cached for a year with the max-age option.</p>
<p>For nginx, use this:</p>
<pre>location ~ \.(js|css|png|jpeg|jpg|gif|ico|swf|flv|pdf|zip)$ {
    expires 24h;
    <a href="http://wiki.nginx.org/NginxHttpHeadersModule#add_header">add_header</a> Cache-Control public;
}</pre>
<p><strong>Update:</strong> it looks like Firefox ignores the Cache-Control and caches everything from SSL connections, <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=531801" target="_blank">unless you use the "no-store" option</a>.</p>
<h2>Beware of CDN with multiple domains</h2>
<p>If you followed a bit the usual performance tips, you already offloaded your static assets (Javascript, CSS, pictures) to a content delivery network. That is a good idea for a SSL deployment too, BUT, there are caveats:</p>
<ul>
<li>your CDN must have servers accessible over SSL, otherwise you will see the "mixed content" warning</li>
<li>it must have "Keep-Alive" and "Cache-control: public" activated</li>
<li><strong>it should serve all your assets from only one domain!</strong></li>
</ul>
<p>Why the last one? Well, even if multiple domains point to the same IP, the browser will do a new handshake for every domain. So, here, we must go against the common wisdom of separating your assets on multiple domains to profit from the parallelized request in the browser. If all the assets are served from the same domain, there will only be one handshake. It could be fixed to allow multiple domains, but this is beyond the scope of this article.</p>
<h2>More?</h2>
<p>I could talk for hours about how you could tweak your web server performance with SSL. There is alot more to it than these easy tips, but I hope those will be of useful for you!</p>
<p>If you want to know more,<strong> I am currently writing <a title="SSL: what you need to know" href="http://leanpub.com/SSL" target="_blank">an ebook about SSL tuning</a></strong>, and I would love to hear your comments about it!</p>
<p><strong>If you need help with your SSL configuration,<a title="Geoffroy Couprie, freelance in software development and security" href="http://geoffroycouprie.com/" target="_blank"> I am available for consulting</a></strong>, and always happy to work on interesting architectures.</p>
<p>By the way, if you want to have a good laugh with SSL, read <a title="How to get a certificate signed by multiple certification authorities" href="http://unhandledexpression.com/2011/11/18/how-to-get-a-certificate-signed-by-multiple-certification-authorities/" target="_blank">"How to get a certificate signed by multiple certification authorities"</a> :)</p>

    

    
      
      
      

      
    
  </article>
  
  <article class="post-body">
    <h2 class="post-title">
      <a href="/general/mobile/2013/01/16/pilotssh-manage-your-server-in-a-few-touches.html">
        PilotSSH: manage your server in a few touches
      </a>
    </h2>
    <div class="post-meta">
  <span class="post-date">16 Jan 2013</span>
  <span class="post-categories">
    
      &bull;

      
      
      

      
        General
      
    
      &bull;

      
      
      

      
        Mobile
      
    
  </span>
</div>

    
      <p>I just released <a title="Pilot SSH" href="http://pilotssh.com/?utm_source=link1&amp;utm_medium=unhandledexpression&amp;utm_campaign=announce" target="_blank">Pilot SSH</a>, a server administration application for iPhone. So, why another SSH application? Aren't there dozens of these already?</p>
<p>I tried a lot of those shell applications, and they felt clunky on a phone. They are fine with a tablet (even more if you use a bluetooth keyboard), but writing commands on a phone's keyboard is not really intuitive. Moreover, the small screen of a phone is not really usable to display the command results.</p>
<p>But I reaaaaally wanted to manage my servers from my phone. Because I am not always in front of my computer. Because I am too lazy to get the laptop from the bag, open it, plug the 3G key or find WiFi, connect over SSH and type a command to restart a crashed web server. Because it would be awesome to be in a bar and say "hold on, I have update my server", open my phone and do it in 3 touches.</p>
<p>So, here it is, Pilot SSH, in all its glory, can out of the box:</p>
<ul>
<li>display running processes, the memory they use, and kill them</li>
<li>show which websites are enabled or disabled in Apache</li>
<li>display the uptime, halt or reboot the server</li>
<li>show Apache logs</li>
</ul>
<p><img class="size-medium wp-image-544" alt="Pilot SSH process list" src="/assets/process_list.png?w=200" width="200" height="300" /> Pilot SSH process list</p>
<p>But there is more! The application is completely extensible, because it uses scripts stored on the server side, in your home, in <strong>~/.pilotssh</strong>. You can totally replace the current scripts, download more from <a title="Pilot SSH scripts" href="https://github.com/Geal/PilotSSH-scripts" target="_blank">the Github repository</a>, and make your own! The scripts can be written in any language, as long as they return a JSON string conforming to the API.</p>
<p>I already got a contribution soon after the launch, with a script to flush the caches. And I have a lot of ideas for new scripts:</p>
<ul>
<li>upgrade a Wordpress website</li>
<li>display the status of processes managed by Monit</li>
<li>create/remove users</li>
<li>Support nginx too</li>
<li>Display more logs</li>
</ul>
<p>This is just the beginning, and I expect a lot of impressive ideas from the users of Pilot SSH. I can't wait to see them!</p>
<p>Do you want to try Pilot SSH? Everything you need is on <a title="Pilot SSH" href="http://pilotssh.com/?utm_source=link2&amp;utm_medium=unhandledexpression&amp;utm_campaign=announce" target="_blank">its website</a>!</p>

    

    
      
      
      

      
    
  </article>
  

  
<div class="pagination">
  <a class="pagination-item older"
     href="/page7">
    Older
  </a>
</div>


</div>
    </main>

    <!-- Optional footer content -->

  </body>
</html>
