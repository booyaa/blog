<!DOCTYPE html>
<html lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta http-equiv="content-type" content="text/html; charset=utf-8" />

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1" />

  <title>
    
      Unhandled Expression &middot; Geoffroy Couprie – software security and architecture consultant
    
  </title>

  
  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-117988815-1', 'auto');
  ga('send', 'pageview');
  </script>



  <!-- CSS -->
  <link rel="stylesheet" href="/assets/css/main.css" />
  

<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Abril+Fatface" />

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/favicon.png" />
<link rel="shortcut icon" href="/favicon.ico" />

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/feed.xml" />

  <!-- Additional head bits without overriding original head -->
</head>


  <body class="index">

    <div id="sidebar">
  <header>
    <img src="https://s.gravatar.com/avatar/ed9901b9b80743c05aedf58b4f4926dd?s=200" alt="self" />
    <h1 class="site-title">
      <a href="/">
        
          <span class="back-arrow icon"><svg fill="#000000" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
  <path d="M0 0h24v24H0z" fill="none"/>
  <path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/>
</svg></span>
        
        Unhandled Expression
      </a>
    </h1>
    <p class="lead">Geoffroy Couprie – software security and architecture consultant</p>
  </header>
  <nav id="sidebar-nav-links">
  
    <a class="home-link "
        href="/">Home</a>
  
  

  

  


  
    
  

  
    
      <a class="page-link "
          href="/about.html">About</a>
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  


  


  
    
  

  
    
  

  
    
      <a class="category-link "
          href="/category/architecture.html">Architecture</a>
    
  

  
    
      <a class="category-link "
          href="/category/crypto.html">Crypto</a>
    
  

  
    
      <a class="category-link "
          href="/category/development.html">Development</a>
    
  

  
    
  

  

  
    
      <a class="category-link "
          href="/category/rust.html">Rust</a>
    
  

  
    
  

  
    
      <a class="category-link "
          href="/category/security.html">Security</a>
    
  

  
    
  

  
    
      <a class="category-link "
          href="/category/videolan.html">VideoLAN</a>
    
  

  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  


  <!-- Optional additional links to insert in sidebar nav -->
</nav>


  <nav id="sidebar-icon-links">
  

  <a id="subscribe-link"
     class="icon" title="Subscribe" aria-label="Subscribe"
     href="/feed.xml">
    <svg fill="#000000" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
    <path d="M0 0h24v24H0z" fill="none"/>
    <circle cx="6.18" cy="17.82" r="2.18"/>
    <path d="M4 4.44v2.83c7.03 0 12.73 5.7 12.73 12.73h2.83c0-8.59-6.97-15.56-15.56-15.56zm0 5.66v2.83c3.9 0 7.07 3.17 7.07 7.07h2.83c0-5.47-4.43-9.9-9.9-9.9z"/>
</svg>
  </a>

  
  
  
  

  
    <a id="tags-link"
       class="icon"
       title="Tags" aria-label="Tags"
       href="/tags.html">
      <svg fill="#000000" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
    <path d="M0 0h24v24H0z" fill="none"/>
    <path d="M17.63 5.84C17.27 5.33 16.67 5 16 5L5 5.01C3.9 5.01 3 5.9 3 7v10c0 1.1.9 1.99 2 1.99L16 19c.67 0 1.27-.33 1.63-.84L22 12l-4.37-6.16z"/>
</svg>
    </a>
  

  
    <a id="search-link"
       class="icon"
       title="Search" aria-label="Search"
       href="/search.html">
      <svg fill="#000000" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
    <path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/>
    <path d="M0 0h24v24H0z" fill="none"/>
</svg>
    </a>
  

  <!-- Optional additional links to insert for icons links -->
</nav>
  <a class="category-link active" href="https://www.patreon.com/geoffroy">Support my work on Patreon</a>
  <!--<p>
  &copy; 2018.
  <a href="/LICENSE.md">MIT License.</a>
</p>
-->
</div>


    <main class="container">
      <div class="content">
  
<div class="pagination">
  <a class="pagination-item newer"
     href="/page6">
    Newer
  </a>
</div>



  

  
  <article class="post-body">
    <h2 class="post-title">
      <a href="/general/security/2013/01/14/harden-wordpress-using-database-permissions.html">
        Harden Wordpress using database permissions
      </a>
    </h2>
    <div class="post-meta">
  <span class="post-date">14 Jan 2013</span>
  <span class="post-categories">
    
      &bull;

      
      
      

      
        General
      
    
      &bull;

      
      
      

      
        <a href="/category/security.html">
          Security
        </a>
      
    
  </span>
</div>

    
      <p>Here is a small idea that I would like to throw into the world: most web applications use only one database user for most operations (installation, administration, common usage). Couldn't we harness the database to protect a bit your data?</p>
<h2>How to</h2>
<p>This is how you could do it:</p>
<ul>
<li>Create one user (called 'user') with full privileges on the database</li>
<li>Create another user with no privileges (let's call him 'read')</li>
<li>Create a copy of wp-config.php that you will name wp-config-admin.php</li>
<li>Write the 'read' credentials in the wp-config.php and the normal credentials in wp-config-admin.php (don't forget to use different auth, secure auth, logged in and nonce keys)</li>
<li>Create a copy of wp-load.php that you will name wp-load-admin.php</li>
<li>Replace in wp-load-admin.php the reference to wp-config.php by wp-config-admin.php</li>
<li>Replace in wp-login.php and wp-admin/* the references to wp-load.php by wp-load-admin.php</li>
<li>Now, you can use the admin interface, create posts, etc.</li>
<li>Grant some permissions to the 'read' database user: GRANT SELECT ON `db`.* TO 'read'; GRANT INSERT, UPDATE ON `db`.`wp_comments` TO 'read';</li>
</ul>
<p>That was a bit of work, but not that hard! So, what did we do here? We created a user for the admin interface with full privileges on the database (create/update posts, change the taxonomy, approve the comments, etc) and another one for the front end interface, with only read privileges on all tables (that bothers me too, but read on).</p>
<p>This means that SQL injections, either in plugins or in Wordpress code (out of the admin panel) will be much harder to implement with this setup. Beware of the custom tables for some plugins. Those will require specific permissions. Depending on the plugin, some could be read only for common usage.</p>
<h2>Going further</h2>
<p>That's nice, but not enough in my opinion. As I said, the full select permission for the 'read' user bothers me. Couldn't we restrict a bit the permissions on wp_users? Some of <a title="WordPress database diagram" href="http://codex.wordpress.org/images/9/9e/WP3.0-ERD.png">the columns</a> are needed, but do we need to access the user_pass column? Also, the "ALL PRIVILEGES" for 'user' is a bit too much. Do we really use the "FILE" privilege (out of SQL injections :D)?</p>
<p>Without further ado, here are the SQL commands you should use:</p>
<blockquote><p>GRANT SELECT, INSERT, UPDATE ON `db`.`wp_comments` TO 'read';</p>
<p>GRANT SELECT ON `db`.`wp_commentmeta` TO 'read';</p>
<p>GRANT SELECT ON `db`.`wp_links` TO 'read';</p>
<p>GRANT SELECT ON `db`.`wp_options` TO 'read';</p>
<p>GRANT SELECT ON `db`.`wp_term_taxonomy` TO 'read';</p>
<p>GRANT SELECT ON `db`.`wp_usermeta` TO 'read';</p>
<p>GRANT SELECT ON `db`.`wp_terms` TO 'read';</p>
<p>GRANT SELECT ON `db`.`wp_term_relationships` TO 'read';</p>
<p>GRANT SELECT ON `db`.`wp_postmeta` TO 'read';</p>
<p>GRANT SELECT ON `db`.`wp_posts` TO 'read';</p>
<p>GRANT SELECT (user_activation_key, id, user_login, user_nicename, user_status, user_url, display_name, user_email, user_registered) ON `db`.`wp_users` TO 'read';</p>
<p>REVOKE ALL PRIVILEGES ON `db`.* from 'user';</p>
<p>GRANT SELECT, INSERT, DELETE, UPDATE, CREATE, DROP, ALTER, INDEX <em>ON `db`.* TO 'user';<br />
</em></p></blockquote>
<p>With these commands, 'user' can only manipulate tables. If you're an evil DBA, you can even revoke the "CREATE, DROP, ALTER" permission after install, and reactivate them only for upgrades or plugin installation. The 'read' user has the same permissions as before on wp_comments, has "SELECT" on all tables except the wp_users. For wp_users, we grant "SELECT" on all columns except the user_pass one.</p>
<p><strong>Thanks to this configuration, even a SQL injection in a plugin will not reach the password hashes!</strong> We also removed dangerous permissions like "FILE". I'd like to prevent timing attacks like "SELECT BENCHMARK(5000000,ENCODE('MSG','by 5 seconds'));" but i did not figure out what is the right syntax for this (I tried variations around: "revoke execute on function benchmark from read", without result).</p>
<p>Thankfully, WordPress mostly works with this configuration, and I think that a lot of other applications could be protected like this. Imagine: you could grant insert but not select on the credit card table in an e-commerce application, and process transactions with a background task with the right permissions.</p>
<p>Database privileges are indeed a powerful tool to protect your code from SQL injections. They might require some architectural changes, but the profits can be huge for your security.</p>

    

    
      
      
      

      
    
  </article>
  
  <article class="post-body">
    <h2 class="post-title">
      <a href="/videolan/2012/12/20/vlc-for-win8-building-the-new-compatibility-layer.html">
        VLC For Win8: building the new compatibility layer
      </a>
    </h2>
    <div class="post-meta">
  <span class="post-date">20 Dec 2012</span>
  <span class="post-categories">
    
      &bull;

      
      
      

      
        <a href="/category/videolan.html">
          VideoLAN
        </a>
      
    
  </span>
</div>

    
      <p>As you can see, <strong>we are doing a <a title="VLC Kickstarter" href="https://bitly.com/U4mfxS" target="_blank">KickStarter for the Windows 8 (WinRT) port of VLC media player</a></strong>. The goal is to take our existing code, which already works on Windows 8's "desktop mode", and make it run on WinRT, the "Metro" interface.</p>
<p>Porting code to WinRT offers significant challenges, mainly caused by the changes in the APIs. A lot of functions we were using, like LoadLibrary, are not available anymore, and replaced by slightly different functions (like <a href="http://msdn.microsoft.com/en-us/library/windows/desktop/hh447159%28v=vs.85%29.aspx" target="_blank">LoadPackagedLibrary</a>). Those might not be too hard to integrate into our current code base.</p>
<p>Other APIs, like sockets, were replaced by their COM interfaces counterpart (for instance Windows.Networking.Sockets). They are used to provide asynchronous interfaces for code running under WinRT. They got inspiration from mobile applications and the "always responsive" goal: a WinRT application should not use blocking code, and should go to sleep or wake up quickly if needed. With COM interfaces, the code polling the socket is executed in another process, and the data is provided through a callback. This changes a bit the usual networking code (connect-&gt;select-&gt;read-&gt;select&gt;...) and we need to write a large layer of compatibility code.</p>
<p>After all of that, we still have to solve the issue of packaging. We already experimented a bit with side loading, which offers an easy way to distribute applications, but the real goal is to push VLC media player to the Windows Store.</p>
<p>So, <a title="Why we need a KickStarter for Metro" href="http://www.jbkempf.com/blog/post/2012/Why-we-need-a-KickStarter-for-Metro" target="_blank">why are we doing this</a>? Windows 8 is happening, it is now preinstalled on most of the new computers.</p>
<p>Why am I excited to work on this port? This KickStarter will give us the opportunity to work full time on WinRT for a few months, and solve all these challenges for us, but also for other open source projects. We already know how to create a <a title="VLC's compatibility library" href="http://git.videolan.org/?p=vlc.git;a=tree;f=compat;h=324f1cea3fda392582397d36898615a493b5e3a9;hb=HEAD" target="_blank">compatibility layer</a> for different operating systems, so we will be able to build one for WinRT. We could also come up with guidelines on using free software toolchains to build WinRT applications.</p>
<p>Basically, we're paving the way to WinRT for opensource libraries and applications, with the nice side effect on running VLC on Windows 8.</p>
<p><strong>Help us make this project a reality! Please contribute to our <a title="VLC for Windows 8 Kickstarter" href="https://bitly.com/U4mfxS" target="_blank">Kickstarter for Windows 8</a>!</strong></p>

    

    
      
      
      

      
    
  </article>
  
  <article class="post-body">
    <h2 class="post-title">
      <a href="/development/general/2012/12/07/testing-android-push-without-a-server.html">
        Testing Android push without a server
      </a>
    </h2>
    <div class="post-meta">
  <span class="post-date">07 Dec 2012</span>
  <span class="post-categories">
    
      &bull;

      
      
      

      
        <a href="/category/development.html">
          Development
        </a>
      
    
      &bull;

      
      
      

      
        General
      
    
  </span>
</div>

    
      <p>Adding push support to an Android app is quite easy, but it can be cumbersome to test it if the server part is not ready yet.</p>
<p>For this, you only need your API key, and the registration ID for your device (you can get it from a call to <em>GCMRegistrar.getRegistrationId</em>). Also, you should have already called <em>GCMRegistrar.register</em> from your app, with your sender id.</p>
<p>Then, to send a push message to your application, use this code:</p>
<blockquote><p>import java.io.IOException;</p>
<p>import com.google.android.gcm.server.*;</p>
<p>public class Main {</p>
<p>/**<br />
* @param args<br />
*/<br />
public static void main(String[] args) {</p>
<p>String apiKey = "...";</p>
<p>String deviceId = "...";<br />
Sender sender = new Sender(apiKey);<br />
Message message = new Message.Builder().addData("data1", "hello").build();</p>
<p>try {<br />
Result result = sender.send(message, deviceId, 2);<br />
System.out.println("got result: "+result.toString());<br />
} catch (IOException e) {<br />
// TODO Auto-generated catch block<br />
e.printStackTrace();<br />
}<br />
}</p>
<p>}</p></blockquote>

    

    
      
      
      

      
    
  </article>
  
  <article class="post-body">
    <h2 class="post-title">
      <a href="/development/security/2012/11/14/warning-your-users-about-a-vulnerability.html">
        Warning your users about a vulnerability
      </a>
    </h2>
    <div class="post-meta">
  <span class="post-date">14 Nov 2012</span>
  <span class="post-categories">
    
      &bull;

      
      
      

      
        <a href="/category/development.html">
          Development
        </a>
      
    
      &bull;

      
      
      

      
        <a href="/category/security.html">
          Security
        </a>
      
    
  </span>
</div>

    
      <p>Somebody just told you about a <a title="Sophos vs Tavis Ormandy" href="http://seclists.org/fulldisclosure/2012/Nov/31" target="_blank">vulnerability in your code</a>. Moreover, they published <a title="The most dangerous code in the world" href="https://crypto.stanford.edu/~dabo/pubs/abstracts/ssl-client-bugs.html" target="_blank">a paper</a> about it. Even worse, people have been <a title="CryptoCat was just totally broken yesterday" href="https://twitter.com/ioerror/status/266648847797854209" target="_blank">very vocal</a> about it.<br />
What can you do now? The usual (and natural) reaction is to downplay the vulnerability, and try to keep it confidential. After all, publishing a vuln will make your users unsafe, and it is bad publicity for your project, right?</p>
<p>WRONG!</p>
<p>The best course of action is to communicate a lot. Here's why:</p>
<h2>Communicate with the security researcher</h2>
<p>Yes, I know, we security people tend to be harsh, quickly flagging a vulnerable project as "broken", "dangerous for your customers" or even "<a title="My little pwnies" href="http://pwnies.com/winners/" target="_blank">EPIC FAIL</a>". That is, unfortunately, part of the folklore. But behind that, security researchers are often happy to help you fix the problem, so take advantage of that!</p>
<p>If you try to silence the researcher, you will not get any more bug reports, but your software will still be vulnerable. Worse, someone else will undoubtedly find the vulnerability, and may sell it to governments and/or criminals.</p>
<p>Vulnerabilities are inevitable, like bugs. Even if you're very careful, <a title="QMail vulnerabilities" href="http://www.cvedetails.com/vulnerability-list/vendor_id-86/product_id-143/Dan-Bernstein-Qmail.html" target="_blank">people will still find ways</a> to break your software. Be humble and accept them, they're one of the costs of writing software. The only thing that should be on your mind when you receive a security report is protecting your users. The rest is just ego and fear of failure.</p>
<p>So, be open, talk to security researchers, and make it easy for them to contact you (<strong>tips: create a page dedicated to security on your website, and provide a specific email for that</strong>).</p>
<h2>Damage control of a public vulnerability</h2>
<p>What do you do when you discover the weakness on the news/twitter/whatever?</p>
<p>Communicate. Now.</p>
<p>Contact the researchers, contact the journalists writing about it, the users whining about the issue, write on your blog, on twitter, on facebook, on IRC, and tell them this: "<strong>we know about the issue, we're looking into it, we're doing everything we can to fix it, and we'll update you as soon as it's fixed</strong>".</p>
<p>This will buy you a few hours or days to fix the issue. You can't say anything else, because you probably don't know enough about the problem to formulate the right opinion. <strong>What you should not say</strong>:</p>
<ul>
<li>"we've seen no report of this exploited in the wild", yet</li>
<li>"as far as we know, the bug is not exploitable", but soon it will be</li>
<li>"the issue happens on a test server, not in production" = "we assume that the researcher didn't also test on prod servers"</li>
<li>"no worries, there's a warning on our website telling that it's beta software". Beta means people are using it.</li>
</ul>
<p>Anything you could say in the few days you got might harm your project. Take it as an opportunity to cool your head, work on the vulnerability, test regressions, find other mitigations, and plan the new release.</p>
<p>Once it is done, publish the security report:</p>
<h2>Warning your users</h2>
<p>So, now, you fixed the vulnerability. You have to tell your users about it. As time passes, more and more people will learn about the issue, so they might as well get it from you.</p>
<p><strong>You should have a <a title="VideoLAN security information" href="http://www.videolan.org/security/" target="_blank">specific webpage for security issues</a></strong>. You may fear that criminals might use it to attack your software or website. Don't worry, they don't need it, they have other ways to know about software weaknesses. This webpage is for your users. It has multiple purposes:</p>
<ul>
<li>showing that you handle security issues</li>
<li>telling which versions someone should not use</li>
<li>explaining how to fix some vulnerabilities if people cannot update</li>
</ul>
<p>For each vulnerability, here is what you should display:</p>
<ul>
<li>the title (probably chosen by the researcher)</li>
<li>the security researcher's name</li>
<li>the <a title="Common Vulnerabilities and Exposures" href="http://cve.mitre.org/" target="_blank">CVE identifier</a></li>
<li>the chain of events:
<ul>
<li>day of report</li>
<li>dates of back and forth emails with the researcher</li>
<li>day of fix</li>
<li>day of release (for software)</li>
<li>day of deploy (for web apps)</li>
</ul>
</li>
<li><strong>the affected versions</strong> (for software, not web apps)</li>
<li>t<strong>he affected components</strong> (maybe the issue only concerns specific parts of a library)</li>
<li>how it can be exploited. You don't need to get into the details of the exploit.</li>
<li><strong>The target of the exploit.</strong> Be very exhaustive about the consequences. Does the attacker get access to my contacts list? Can he run code on my computer? etc.</li>
<li><strong>The mitigations</strong>. Telling to update to the latest version is not enough. Some users will not update right away, because they have their own constraints. Maybe they have a huge user base and can't update quickly. Maybe they rely on an old feature removed in the latest version. Maybe their users refuse to update because it could introduce regressions. What you should tell:
<ul>
<li>which version is safe (new versions with the fix, but also old versions if the issue was introduced recently)</li>
<li>if it's open source, which commit introduced the fix. That way, people managing their own internal versions of software can fix it quickly</li>
<li>how to fix the issue without updating (<a href="http://www.reddit.com/r/netsec/comments/13664q/skype_vulnerability_allowing_hijacking_of_any/c715m20" target="_blank">example for a recent Skype bug</a>). You can provide a quick fix, that will buy time for sysadmins and downstream developers to test, fix and deploy the new version.</li>
</ul>
</li>
</ul>
<p>Now that you have a good security report, contact again the security researchers, journalists and users, provide them with the report, and emphasize what users risked, and how they can fix it. You can now comment publicly about the issue, make a blog post, send emails to your users to tell them how much you worked to protect them. And don't forget the consecrated formule: "we take security very seriously and have taken measures to prevent this issue from happening ever again".</p>
<p><strong>Do you need help fixing your vulnerabilities? <a title="Geoffroy Couprie, freelance in software development and security" href="http://geoffroycouprie.com/" target="_blank">Feel free to contact me!</a></strong></p>

    

    
      
      
      

      
    
  </article>
  
  <article class="post-body">
    <h2 class="post-title">
      <a href="/development/general/security/2012/11/05/going-to-the-freelance-side.html">
        Going to the freelance side
      </a>
    </h2>
    <div class="post-meta">
  <span class="post-date">05 Nov 2012</span>
  <span class="post-categories">
    
      &bull;

      
      
      

      
        <a href="/category/development.html">
          Development
        </a>
      
    
      &bull;

      
      
      

      
        General
      
    
      &bull;

      
      
      

      
        <a href="/category/security.html">
          Security
        </a>
      
    
  </span>
</div>

    
      <p>From now on, I am an independent geek! After nearly 2 years at Login People, I am jumping out in the sea to work for myself.</p>
<p>I will do mainly web development (Rails, Node.JS) and software security (penetration testing, code reviews, protocol audit). Feel free to <a title="Geoffroy Couprie, freelance in software development and security" href="http://geoffroycouprie.com/" target="_blank">contact me</a> for missions, I will be happy to work with you!</p>

    

    
      
      
      

      
    
  </article>
  

  
<div class="pagination">
  <a class="pagination-item older"
     href="/page8">
    Older
  </a>
</div>


</div>
    </main>

    <!-- Optional footer content -->

  </body>
</html>
