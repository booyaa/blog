<!DOCTYPE html>
<html lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta http-equiv="content-type" content="text/html; charset=utf-8" />

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1" />

  <title>
    
      Unhandled Expression &middot; Geoffroy Couprie – software security and architecture consultant
    
  </title>

  
  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-117988815-1', 'auto');
  ga('send', 'pageview');
  </script>



  <!-- CSS -->
  <link rel="stylesheet" href="/assets/css/main.css" />
  

<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Abril+Fatface" />

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/favicon.png" />
<link rel="shortcut icon" href="/favicon.ico" />

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/feed.xml" />

  <!-- Additional head bits without overriding original head -->
</head>


  <body class="index">

    <div id="sidebar">
  <header>
    <img src="https://s.gravatar.com/avatar/ed9901b9b80743c05aedf58b4f4926dd?s=200" alt="self" />
    <h1 class="site-title">
      <a href="/">
        
          <span class="back-arrow icon"><svg fill="#000000" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
  <path d="M0 0h24v24H0z" fill="none"/>
  <path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/>
</svg></span>
        
        Unhandled Expression
      </a>
    </h1>
    <p class="lead">Geoffroy Couprie – software security and architecture consultant</p>
  </header>
  <nav id="sidebar-nav-links">
  
    <a class="home-link "
        href="/">Home</a>
  
  

  

  


  
    
  

  
    
      <a class="page-link "
          href="/about.html">About</a>
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  


  


  
    
  

  
    
  

  
    
      <a class="category-link "
          href="/category/architecture.html">Architecture</a>
    
  

  
    
      <a class="category-link "
          href="/category/crypto.html">Crypto</a>
    
  

  
    
      <a class="category-link "
          href="/category/development.html">Development</a>
    
  

  
    
  

  

  
    
      <a class="category-link "
          href="/category/rust.html">Rust</a>
    
  

  
    
  

  
    
      <a class="category-link "
          href="/category/security.html">Security</a>
    
  

  
    
  

  
    
      <a class="category-link "
          href="/category/videolan.html">VideoLAN</a>
    
  

  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  


  <!-- Optional additional links to insert in sidebar nav -->
</nav>


  <nav id="sidebar-icon-links">
  

  <a id="subscribe-link"
     class="icon" title="Subscribe" aria-label="Subscribe"
     href="/feed.xml">
    <svg fill="#000000" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
    <path d="M0 0h24v24H0z" fill="none"/>
    <circle cx="6.18" cy="17.82" r="2.18"/>
    <path d="M4 4.44v2.83c7.03 0 12.73 5.7 12.73 12.73h2.83c0-8.59-6.97-15.56-15.56-15.56zm0 5.66v2.83c3.9 0 7.07 3.17 7.07 7.07h2.83c0-5.47-4.43-9.9-9.9-9.9z"/>
</svg>
  </a>

  
  
  
  

  
    <a id="tags-link"
       class="icon"
       title="Tags" aria-label="Tags"
       href="/tags.html">
      <svg fill="#000000" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
    <path d="M0 0h24v24H0z" fill="none"/>
    <path d="M17.63 5.84C17.27 5.33 16.67 5 16 5L5 5.01C3.9 5.01 3 5.9 3 7v10c0 1.1.9 1.99 2 1.99L16 19c.67 0 1.27-.33 1.63-.84L22 12l-4.37-6.16z"/>
</svg>
    </a>
  

  
    <a id="search-link"
       class="icon"
       title="Search" aria-label="Search"
       href="/search.html">
      <svg fill="#000000" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
    <path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/>
    <path d="M0 0h24v24H0z" fill="none"/>
</svg>
    </a>
  

  <!-- Optional additional links to insert for icons links -->
</nav>
  <a class="category-link active" href="https://www.patreon.com/geoffroy">Support my work on Patreon</a>
  <!--<p>
  &copy; 2018.
  <a href="/LICENSE.md">MIT License.</a>
</p>
-->
</div>


    <main class="container">
      <div class="content">
  
<div class="pagination">
  <a class="pagination-item newer"
     href="/page9">
    Newer
  </a>
</div>



  

  
  <article class="post-body">
    <h2 class="post-title">
      <a href="/development/general/2011/02/18/the-geal-test-extending-the-joel-test.html">
        The Geal test: extending the Joel Test
      </a>
    </h2>
    <div class="post-meta">
  <span class="post-date">18 Feb 2011</span>
  <span class="post-categories">
    
      &bull;

      
      
      

      
        <a href="/category/development.html">
          Development
        </a>
      
    
      &bull;

      
      
      

      
        General
      
    
  </span>
</div>

    
      <p>The <a title="Joel on software - the Joel test" href="http://www.joelonsoftware.com/articles/fog0000000043.html" target="_blank">Joel test</a> was written by Joel Spolsky to provide a few very simple questions for developers to ask in an interview. Here they are:</p>
<blockquote><p><strong>The Joel Test</strong></p>
<ol>
<li>Do you use source control?</li>
<li>Can you make a build in one step?</li>
<li>Do you make daily builds?</li>
<li>Do you have a bug database?</li>
<li>Do you fix bugs before writing new code?</li>
<li>Do you have an up-to-date schedule?</li>
<li>Do you have a spec?</li>
<li>Do programmers have quiet working conditions?</li>
<li>Do you use the best tools money can buy?</li>
<li>Do you have testers?</li>
<li>Do new candidates write code during their interview?</li>
<li>Do you do hallway usability testing?</li>
</ol>
</blockquote>
<p>They seem basic, and that's the point: a company with a poor score doesn't give a nice environment to its developers.</p>
<p>While this test is still applicable, it was written in 2000, and software development has seen a lot of changes and innovation. So, I thought of a few other questions that you can ask your current or future employer:</p>
<blockquote><p><strong>The Geal Test</strong></p>
<ol>
<li>Do you use agile development methods?</li>
<li>Do you have unit tests?</li>
<li>Do you perform code reviews?</li>
<li>Do you use known technologies and frameworks (open source or not)?</li>
<li>Do developers train and learn on office hours, or in their spare time?</li>
<li>Do developers communicate with system administrators (deployment requests and bug reports don't count)?</li>
<li>Do developers communicate with the client?</li>
<li>Do developers retain copyright on the work done in their spare time?</li>
</ol>
</blockquote>
<p>That's it, 8 more questions, 1 point by positive answer.  Joel said that 11 or 12 for his test is ok. I'm nicer, so I'll say that 6 on my test is good enough.</p>
<h2>1. Do you use agile development methods?</h2>
<p>Agile methods have been there for a few years now, and they have proven useful for a lot of projects, especially when you have changing requirements or a very short time to market. Don't let your developers fight everyday against specifications written 5 years ago, let them adapt on the way.</p>
<h2>2. Do you have unit tests?</h2>
<p>This should be standard. There are a lot of libraries to write tests in every language, for specific functions, for APIs, for user interfaces, so this approach is well supported. Moreover, if you answered "yes" to Joel's question about daily builds, you can add tests to the loop, and run them right after the daily build. If you're not convinced about the usefulness of unit tests, or fear that it will take too much time: unit tests give you assurance that you won't break the code, they can validate the compliance with the specifications, and automated unit tests will save some time for development. You don't want to pay a developer to test manually over and over the same code, but you can buy a machine to do that.</p>
<h2>3. Do you perform code reviews?</h2>
<p>I know that this one is hard to implement in a team, but once the developers are past the "I'm too shy to show you my code" phase, this will help them spot mistakes, learn from the better developers and find new ways to improve the code.</p>
<h2>4. Do you use known technologies and frameworks (open source or not)?</h2>
<p>A lot of companies have custom frameworks that they develop and use for their products, that nobody else uses. Although it can be comforting to have your own technology, that you control and maintain, it has a few problems:</p>
<ul>
<li>it reeks of <a title="Not Invented Here" href="http://en.wikipedia.org/wiki/Not_Invented_Here" target="_blank">NIH syndrome</a></li>
<li>it is a cost not directly linked to what you're selling</li>
<li>you have to train developers to use it</li>
<li>the expertise they build will be useless in future jobs</li>
</ul>
<p>If you use known (and hopefully, recent) technologies, you don't have to maintain it (although you may need to pay for it), you profit from bugfixes for other clients, and you are more likely to attract and hire skilled developers. Seriously, I don't want to waste years to maintain your dead framework.</p>
<h2>5. Do developers train and learn on office hours, or in their spare time?</h2>
<p>Software development moves very fast and a developer needs to catch up often. If you don't allocate time in his schedule to read, try and learn, you can still assume that he will still train himself in his spare time. But you take the risk that your Java developer becomes a Ruby expert, because he will learn what he wants, not what you need. If you want your developers to become experts, help them.</p>
<h2>6. Do developers communicate with system administrators (deployment requests and bug reports don't count)?</h2>
<p>Too often, the only communication between developers and tech ops is through deployment request and bug reports. The consequence: they don't know each other, they don't trust each other, and when there's a problem, they don't work together. Obviously, this is not a good work environment. As a developer, I'm interested in how my code behaves in real conditions, and I would like helpful bug reports, instead of "it doesn't work, I rollback", and knowing and working with the sys admins can provide it.</p>
<h2>7. Do developers communicate with the client?</h2>
<p>Ok, this one will horrify some project managers and a few developers. I know that you want  to control all the interactions with the client, and that developers sometimes have poor communication skills. But if you put a few layers between the developer and the client, this is what the developer will see: specifications that don't make sense, and useless bug reports. Developers are problem analysis machines, so they can understand the needs of your client, and see right away what is implied in architecture, technology and performance. Use their insight, and they will feel useful, and produce better software. Also, if you can, send a developer to watch a  bit how the client works with the software. In 5 minutes, they will spot more bugs and usability problems than in 5 weeks of bug reports.</p>
<h2>8. Do developers retain copyright on the work done in their spare time?</h2>
<p>When you're passionate about development, you often have ideas, itches to scratch, and you may not be able to develop them at work. But a lot of contracts have non competition clauses and other clauses giving copyright of ALL your work to the employer. As an employer, it's a way to protect the company, but as a developer, it is scary: you can't use or sell the code written in your spare time. Let your developers work on what they want when they're not in the office, and you will profit from the experience they gained developing their side projects (but state clearly that they work for you on office hours).</p>
<h2>Bonus</h2>
<p>I also have 4 bonus questions. They're optional, but they don't hurt.</p>
<ul>
<li>Do the developers participate in &lt;LANGUAGE&gt; user groups or developer meetups? In these meetups, they will learn a lot, and if they're experts and enjoy working for you, they will attract other developers.</li>
<li>Will I have a technical manager? It is reassuring for a developer to know that his manager has a clue about development, knows the difference between a good and a bad developer, can understand his problems and stabd up for his team.</li>
<li>Do you use a recent version control software? Joel already asked this, but it needs to be precised. Version control systems have improved a lot since his test so, if you can, avoid old stuff like CVS or (worse) SourceSafe. Subversion is fine for most setups now (even on <a title="TortoiseSVN" href="http://tortoisesvn.net/" target="_blank">Windows</a>), and if you use Git or Mercurial, I will be reaaaally happy.</li>
<li>Do you accept remote working? There are a lot of tools to communicate online: mail, IM, VoIP, web project managers and bug trackers, and developers often know very well how to use them. It's comforting for the employer to know that the developer is always at arm's length, but this will not mean they're more productive. If you remove distractions from the work environment (phone, colleagues), the developer can be more productive (yes, there are actually LESS distractions at home). Also, they won't waste time in transport.</li>
</ul>
<p>Now, if you're a developer, rate your own company or future job. If you're a manager, rate your team, and please, please, on behalf of all the developers out there, try to get the perfect score!</p>
<p>How much did you get?</p>

    

    
      
      
      

      
    
  </article>
  
  <article class="post-body">
    <h2 class="post-title">
      <a href="/smalltalk/2011/02/04/smalltalk-for-engineers.html">
        Smalltalk for engineers
      </a>
    </h2>
    <div class="post-meta">
  <span class="post-date">04 Feb 2011</span>
  <span class="post-categories">
    
      &bull;

      
      
      

      
        Smalltalk
      
    
  </span>
</div>

    
      <p>For more than a year, I have been playing with Smalltalk, and more specifically the <a title="Pharo, an open source Smalltalk" href="http://pharo-project.org" target="_blank">Pharo project</a>, and I had a lot of fun! Now, I'd like to share this experience. I saw a lot of introductions to Smalltalk, but they were all about its amazing features from a CS point of vue. I'm a software engineer, so I'll give you a more pragmatic look, with a few useful tips.</p>
<p>When you hear about Smalltalk, you imagine old bearded guys, clinging to their outdated language. In reality, this is what I saw: a small yet growing community full of nice and motivated people, enjoying development and innovating everyday. Even if the language is old, they're keeping it up to date with today's standards: JIT compiling, web development, iPhone port... I strongly encourage you to take a look and, maybe, participate!</p>
<h2>First look: the interface</h2>
<p>The first impression is the most shocking: you don't understand what you can/should do with that empty window. It is not the code editor you would expect. It is an entire world, full of living objects. The behaviour of these objects is described by code, but they're not programs with a beginning and an end. For a good impression of that, try closing the environment (don't forget to save) and starting it again: your windows are still open, exactly in the same place! Even selected text is still there! Your object's life doesn't end when you close the environment: they're serialized in the image file.</p>
<p><img class="aligncenter size-medium wp-image-164" title="pharo-firstscreen" src="/assets/pharo-firstscreen.jpg?w=300" alt="" width="300" height="205" /></p>
<p>The environment is composed of a virtual machine executing the code, an image file containing the objects, and a source file, storing a part of the source code. And that's all. No files.</p>
<p><strong>UPDATE: </strong>the <a href="http://smalltalk.gnu.org/" target="_blank">GNU Smalltalk</a> environment uses files to store source code.</p>
<p>In the previous picture, you will see the code browser, used for everyday development. It doesn't display files, but (from left to right) categories, classes, method categories, methods, and under that, the actual code for the method. The code editor is organized around the actual structure of the code, not some arbitrary folder tree. It can be confusing at first, but it's actually quite elegant. There's a drawback though: you can't use your favorite code editor to write Smalltalk code. Another nice side effect of the image: I store my environment on a USB key, and can use it to work seamlessly on Windows, Mac and Linux (using the <a title="Download the one click pharo image" href="http://gforge.inria.fr/frs/download.php/28015/Pharo-1.1.1-OneClick.zip">one click pharo image</a>).</p>
<h2>Second look: the language</h2>
<p>The language itself is another surprise: what are those ifTrue and whileTrue? You can't think that Smalltalk has a syntax used for control flow.  In Smalltalk, everything is an object. And the primary way of interacting with an object is sending it a message. The whole syntax of Smalltalk revolves around messages:</p>
<ul>
<li>"1+2/3" is not equal to 5/3, but to 1, because you send to 1 the message "+" with argument 2, which gives you 3, and you send this result the message "/" with argument 3.</li>
<li>ifTrue is a message sent to a boolean, with a "block" as argument (a block is a piece of code). The block will be executed if the boolean is an instance of True.</li>
<li>you can't access directly the members of an object: you need to create messages to read and modify these members.</li>
</ul>
<p>The methods are separated between the class side and the instance side. The classes are objects, so they have their own methods (think of it as static methods). They're used for a lot of things, like generating common instances (String crlf, Color blue, etc), or starting servers.</p>
<p>If you take a good look at a class like string, you will spot apparently redundant methods like displayOn:, displayOn:at:, displayAt:, displayOn:at:textColor:. They're not redundant: displayOn calls displayOn:at:, which calls displayOn:at:textColor:. This is actually very elegant, because it keeps methods small and readable.</p>
<p>Keep that in mind when you're developing in Smalltalk: readability is more important that speed, because the time you gain now will be wasted the next time you try to read your code.</p>
<h2>Next: the tools</h2>
<p>You saw the code browser, but there are other nice tools designed to help you every day.</p>
<p>Monticello is a distributed versioning system integrated in the environment. Nothing special here: it tracks your changes, create revisions, and supports local (folders) and remote (HTTP, FTP) repositories.</p>
<p>There is a test runner that displays all the tests loaded in your environment. You will see that there is a very good coverage, but it is not enough! Contribute a test or two if you have time.</p>
<p>Last but not least: the refactoring browser. It is an amazing piece of code which analyzes your classes, points out design mistakes, and in some cases, can correct them in your place.</p>
<h2>OK, now, what can I develop?</h2>
<p>You can do about anything in Smalltalk, like other languages: desktop applications, web applications, use databases, network protocols, REST APIs... It is particularly suited for big applications with complex object models.</p>
<p>For desktop applications, you will easily have cross platform code and UI, but you won't be able to use native windows (at least, not with Squeak or Pharo). For web applications, you can choose between these frameworks: <a href="http://www.seaside.st">Seaside</a>, <a href="http://www.iliadproject.org">Iliad</a> and <a href="http://www.aidaweb.si/">Aida</a>. Each one has a different philosophy, and different strengths, so try them all out!</p>
<p>Developing in Smalltalk has been an amazing experience: I learned a lot, and the concepts and habits I took are easily applied to other languages. now, I just need a way to work in Smalltalk for my day job :)</p>

    

    
      
      
      

      
    
  </article>
  
  <article class="post-body">
    <h2 class="post-title">
      <a href="/general/security/2010/11/16/gorgeous-spammer-wants-to-add-you-as-a-friend.html">
        Gorgeous spammer wants to add you as a friend
      </a>
    </h2>
    <div class="post-meta">
  <span class="post-date">16 Nov 2010</span>
  <span class="post-categories">
    
      &bull;

      
      
      

      
        General
      
    
      &bull;

      
      
      

      
        <a href="/category/security.html">
          Security
        </a>
      
    
  </span>
</div>

    
      <p style="text-align:justify;">Yesterday was introduced the<a title="The Facebook blog" href="http://blog.facebook.com/blog.php?post=452288242130" target="_blank"> new Facebook Messages interface</a>. Huzzah! You get an @facebook.com email address, unification of IM and email, conversation history, etc. That sounds cool! And what is that new feature called "social inbox"? That's nice, messages from your friends will be prioritized and appear directly in your inbox, and other emails will go to the "others" box. Wait, what?</p>
<p style="text-align:justify;">This feature is meant to help you <del>waste time</del> connect efficiently with your network. I won't go into the analysis of how your email contacts are not always friends, even the important and regular ones, how will Google react, or how will we send emails with no subject line. I'm sure someone will talk about that at length. Instead, let's talk about these nice people always interested in becoming our friends, sell us cheap software enlarge our <del>pe</del> bank account: spammers.</p>
<p style="text-align:justify;">In the old world of regular email (yes, old, we're in Web 2.0, Gmail is soooo last week), we had spam filters. <a title="WP: Antispam techniques" href="http://en.wikipedia.org/wiki/Anti-spam_techniques" target="_blank">A lot of methods</a> were developed to protect us: blacklistingm whitelisting, greylisting, bayesian filters, SMTP verification, CAPTCHAs, etc. They're not all efficient, but services like Gmail are really good at catching unwanted email. Spamming is an activity with a very low conversion rate: you have to send thousands of emails just to get one gullible person to click and buy. Thankfully, emails are cheap to send. But we could improve that conversion rate. Facebook just did it.</p>
<blockquote><p>With new Messages, your Inbox will only contain messages from your friends and their friends. All other messages will go into an Other folder where you can look at them separately.</p></blockquote>
<p style="text-align:justify;">Put you in situation. A gorgeous woman/man/<a href="http://en.wikipedia.org/wiki/On_the_Internet,_nobody_knows_you're_a_dog" target="_blank">dog</a> wants to be your friend on Facebook. Will you accept her/him? Let's say she has more or less the same tastes has you (that's surprinsingly easy to get the list of a band's fans, same for book, political views, etc). Not yet? Let's say you have friends more gullible than you. The hot woman is a friend of another friend and sends you a message in these terms: "Hi! We met at &lt;gullible friend&gt;'s party a few months ago, I had a really good time talking to you". You just accepted the friend request, admit it. And a few days/weeks later, she will begin sending you messages about great opportunities like ponzi schemes or nigerian scams. And YOU WILL CLICK! Because it will appear directly in your inbox. Because it comes from one of your friends, someone you more or less trust.</p>
<p style="text-align:justify;">Facebook just gave spammers a direct access to your inbox, and offered them targeted advertising, thanks to all the groups, likes, music and book fan groups. Spammers are considered dumb, because they automate a lot. But thanks to Facebook's social features, they will learn to customize the mails, just for you. They will pay cheap workers to talk to you through the fake accounts, they will get you, your friends and your family, and will be a part of your great friends network.</p>
<p style="text-align:justify;">Thanks to Facebook.</p>

    

    
      
      
      

      
    
  </article>
  
  <article class="post-body">
    <h2 class="post-title">
      <a href="/videolan/2010/08/27/update-to-a-safer-vlc.html">
        Update to a safer VLC
      </a>
    </h2>
    <div class="post-meta">
  <span class="post-date">27 Aug 2010</span>
  <span class="post-categories">
    
      &bull;

      
      
      

      
        <a href="/category/videolan.html">
          VideoLAN
        </a>
      
    
  </span>
</div>

    
      <p>VLC 1.1.4 is out, with <a href="http://git.videolan.org/?p=vlc/vlc-1.1.git;a=commit;h=43a31df56c37bd62c691cdbe3c1f11babd164b56">a fix</a> for the <a href="http://unhandledexpression.com/2010/08/23/fixing-the-dll-loading-vulnerability/">DLL preloading attack</a>!</p>
<p>Read more about that issue in the <a href="http://www.videolan.org/vlc/releases/1.1.4.html">release notes</a> and the <a href="http://www.videolan.org/security/sa1005.html">security advisory</a>.</p>

    

    
      
      
      

      
    
  </article>
  
  <article class="post-body">
    <h2 class="post-title">
      <a href="/general/security/videolan/2010/08/23/fixing-the-dll-loading-vulnerability.html">
        Fixing the DLL loading vulnerability
      </a>
    </h2>
    <div class="post-meta">
  <span class="post-date">23 Aug 2010</span>
  <span class="post-categories">
    
      &bull;

      
      
      

      
        General
      
    
      &bull;

      
      
      

      
        <a href="/category/security.html">
          Security
        </a>
      
    
      &bull;

      
      
      

      
        <a href="/category/videolan.html">
          VideoLAN
        </a>
      
    
  </span>
</div>

    
      <p><strong>Update 24/08/2010: Microsoft published an <a href="https://www.microsoft.com/technet/security/advisory/2269637.mspx">advisory</a>, there's an <a href="http://blogs.technet.com/b/srd/archive/2010/08/23/more-information-about-dll-preloading-remote-attack-vector.aspx">article from the MSRC</a> about the preloading DLL vulnerability, and <a href="http://support.microsoft.com/kb/2264107">a tool</a> that fixes the problem. And if you want to know more, there's an <a href="http://msdn.microsoft.com/en-us/library/ff919712(VS.85).aspx">MSDN article</a>.</strong></p>
<p><strong>Update 25/08/2010: if you came here from golem.de, heise.de or h-online.com, good for you! The articles on these websites are blatantly wrong, and their proposed solution doesn't work . You will find here the real solutions, and links to the relevant blog posts and advisories.</strong></p>
<p>Look! <a href="http://www.securityfocus.com/archive/1/513190">A new</a> <a href="http://www.cs.ucdavis.edu/research/tech-reports/2010/CSE-2010-2.pdf">shiny</a> <a href="http://blog.metasploit.com/2010/08/exploiting-dll-hijacking-flaws.html">vulnerability</a>, affecting a lot of Windows applications! OMG OMG OMG we're DOOMED!</p>
<p>&lt;/crazy mode off&gt;</p>
<p>OK, let's get serious. This vulnerability is actually <a href="http://www.securityfocus.com/bid/1699/discuss">a very old one</a>. It is there because the <a href="http://msdn.microsoft.com/en-us/library/ms682586(v=VS.85).aspx">DLL search order</a> includes the current directory (if someone can tell me why, I would be delighted to know that). Here is the search order (source: <a href="http://msdn.microsoft.com/en-us/library/ms682586(v=VS.85).aspx">MSDN</a>):</p>
<blockquote><p>If <strong>SafeDllSearchMode</strong> is enabled, the search order is as follows:</p>
<ol>
<li>The directory from which the application loaded.</li>
<li>The system directory. Use the <a href="http://msdn.microsoft.com/en-us/library/ms724373(v=VS.85).aspx"><strong>GetSystemDirectory</strong></a> function to get the path of this directory.</li>
<li>The 16-bit system directory. There is no function that obtains the path of this directory, but it is searched.</li>
<li>The Windows directory. Use the <a href="http://msdn.microsoft.com/en-us/library/ms724454(v=VS.85).aspx"><strong>GetWindowsDirectory</strong></a> function to get the path of this directory.</li>
<li>The current directory.</li>
<li>The directories that are listed in the PATH environment variable. Note that this does not include the per-application path specified by the <strong>App Paths</strong> registry key. The <strong>App Paths</strong> key is not used when computing the DLL search path.</li>
</ol>
<p>If <strong>SafeDllSearchMode</strong> is disabled, the search order is as follows:</p>
<ol>
<li>The directory from which the application loaded.</li>
<li>The current directory.</li>
<li>The system directory. Use the <a href="http://msdn.microsoft.com/en-us/library/ms724373(v=VS.85).aspx"><strong>GetSystemDirectory</strong></a> function to get the path of this directory.</li>
<li>The 16-bit system directory. There is no function that obtains the path of this directory, but it is searched.</li>
<li>The Windows directory. Use the <a href="http://msdn.microsoft.com/en-us/library/ms724454(v=VS.85).aspx"><strong>GetWindowsDirectory</strong></a> function to get the path of this directory.</li>
</ol>
</blockquote>
<p>For the record: disabling SafeDllSearchMode means that you're stupid, or that you're using a Windows before XP SP1 (note that this is not exclusive).</p>
<p>So, let's assume that your application tries to load a DLL that isn't present, either in your application directory, or in the system directories. Then, the application will try to load the DLL from the current directory. And that's it. If there's a DLL with the same name in that folder, it will be loaded in the application. That's why you can get owned by opening a file in that same directory: it sets the current directory of the application to the file's folder.</p>
<p>OMG OMG OMG we're DOOMED, and it's incredibly easy to exploit me!</p>
<p>So, now, let's take a look at the fix. This is an OS flaw. You can't fix all your applications yourself. H.D. Moore has some <a href="http://blog.rapid7.com/?p=5325">sysadmin fixes</a> that you can apply to prevent the exploit from coming on your computer. But your applications will still be exploitable.</p>
<p>If you're a developer, though, you can fix your application. There's a function that can remove the current directory from the DLL search path: SetDllDirectory. From <a href="http://msdn.microsoft.com/en-us/library/ms686203(VS.85).aspx">MSDN</a>:</p>
<blockquote><p>After calling <strong>SetDllDirectory</strong>, the DLL search path is:</p>
<ol>
<li>The directory from which the application loaded.</li>
<li>The directory specified by the <em>lpPathName</em> parameter.</li>
<li>The system directory. Use the <a href="http://msdn.microsoft.com/en-us/library/ms724373(v=VS.85).aspx"><strong>GetSystemDirectory</strong></a> function to get the path of this directory. The name of this directory is System32.</li>
<li>The 16-bit system directory. There is no function that obtains the path of this directory, but it is searched. The name of this directory is System.</li>
<li>The Windows directory. Use the <a href="http://msdn.microsoft.com/en-us/library/ms724454(v=VS.85).aspx"><strong>GetWindowsDirectory</strong></a> function to get the path of this directory.</li>
<li>The directories that are listed in the PATH environment variable.</li>
</ol>
</blockquote>
<p>So, if you pass a safe directory(let's say, C:\Windows\System32, or your application directory) as argument to SetDllDirectory, you effectively remove the current directory from the search path! It works, I tested it for you :)</p>
<p>But that's not the end: you have to wipe out the PATH to be safe. <a href="http://blog.metasploit.com/2010/08/exploiting-dll-hijacking-flaws.html">From the metasploit blog</a>:</p>
<blockquote><p>If the application is trying to load a DLL that is normally found within the PATH, but not the Windows system directories, and the PATH contains environment variables that have not been set, then the literal value of the environment variable will be treated as sub-directory of the working directory (the share). For example, if %unknownvariable%\bin is in the system PATH, the share will be searched for a directory called “%unknownvariable%\bin” and the target DLL will be loaded from within this sub-directory.</p></blockquote>
<p>And if you test  your application with ProcMon, you will surely see that a lot of (potentially unsafe) directories are added to the PATH, and used to look for the DLL. So, remove all the useless directories from the PATH if you can!</p>
<p>(And now, for the disclaimer: this blog post is not endorsed by Microsoft, and if you want to be really safe and know the best solution to employ, wait for Microsoft's patches and workarounds. But if you trust me enough (you fool... *evil laugh*), you can try that fix on your application, and maybe protect your users. )</p>
<p>Actually, that fix is encouraged by Microsoft, and David Leblanc wrote about it in February 2008.</p>

    

    
      
      
      

      
    
  </article>
  

  
<div class="pagination">
  <a class="pagination-item older"
     href="/page11">
    Older
  </a>
</div>


</div>
    </main>

    <!-- Optional footer content -->

  </body>
</html>
