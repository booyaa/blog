<!DOCTYPE html>
<html lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta http-equiv="content-type" content="text/html; charset=utf-8" />

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1" />

  <title>
    
      Unhandled Expression &middot; Geoffroy Couprie – software security and architecture consultant
    
  </title>

  


  <!-- CSS -->
  <link rel="stylesheet" href="/assets/css/main.css" />
  

<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Abril+Fatface" />

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/favicon.png" />
<link rel="shortcut icon" href="/favicon.ico" />

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/feed.xml" />

  <!-- Additional head bits without overriding original head -->
</head>


  <body class="index">

    <div id="sidebar">
  <header>
    <img src="https://s.gravatar.com/avatar/ed9901b9b80743c05aedf58b4f4926dd?s=200" alt="self" />
    <h1 class="site-title">
      <a href="/">
        
          <span class="back-arrow icon"><svg fill="#000000" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
  <path d="M0 0h24v24H0z" fill="none"/>
  <path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/>
</svg></span>
        
        Unhandled Expression
      </a>
    </h1>
    <p class="lead">Geoffroy Couprie – software security and architecture consultant</p>
  </header>
  <nav id="sidebar-nav-links">
  
    <a class="home-link "
        href="/">Home</a>
  
  

  

  


  
    
  

  
    
      <a class="page-link "
          href="/about.html">About</a>
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  


  


  
    
  

  
    
  

  
    
      <a class="category-link "
          href="/category/architecture.html">Architecture</a>
    
  

  
    
      <a class="category-link "
          href="/category/crypto.html">Crypto</a>
    
  

  
    
      <a class="category-link "
          href="/category/development.html">Development</a>
    
  

  
    
  

  

  
    
      <a class="category-link "
          href="/category/rust.html">Rust</a>
    
  

  
    
  

  
    
      <a class="category-link "
          href="/category/security.html">Security</a>
    
  

  
    
  

  
    
      <a class="category-link "
          href="/category/videolan.html">VideoLAN</a>
    
  

  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  


  <!-- Optional additional links to insert in sidebar nav -->
</nav>


  <nav id="sidebar-icon-links">
  

  <a id="subscribe-link"
     class="icon" title="Subscribe" aria-label="Subscribe"
     href="/feed.xml">
    <svg fill="#000000" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
    <path d="M0 0h24v24H0z" fill="none"/>
    <circle cx="6.18" cy="17.82" r="2.18"/>
    <path d="M4 4.44v2.83c7.03 0 12.73 5.7 12.73 12.73h2.83c0-8.59-6.97-15.56-15.56-15.56zm0 5.66v2.83c3.9 0 7.07 3.17 7.07 7.07h2.83c0-5.47-4.43-9.9-9.9-9.9z"/>
</svg>
  </a>

  
  
  
  

  
    <a id="tags-link"
       class="icon"
       title="Tags" aria-label="Tags"
       href="/tags.html">
      <svg fill="#000000" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
    <path d="M0 0h24v24H0z" fill="none"/>
    <path d="M17.63 5.84C17.27 5.33 16.67 5 16 5L5 5.01C3.9 5.01 3 5.9 3 7v10c0 1.1.9 1.99 2 1.99L16 19c.67 0 1.27-.33 1.63-.84L22 12l-4.37-6.16z"/>
</svg>
    </a>
  

  
    <a id="search-link"
       class="icon"
       title="Search" aria-label="Search"
       href="/search.html">
      <svg fill="#000000" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
    <path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/>
    <path d="M0 0h24v24H0z" fill="none"/>
</svg>
    </a>
  

  <!-- Optional additional links to insert for icons links -->
</nav>
  <p>
  &copy; 2018.
  <a href="/LICENSE.md">MIT License.</a>
</p>

</div>


    <main class="container">
      <div class="content">
  
<div class="pagination">
  <a class="pagination-item newer"
     href="/page9">
    Newer
  </a>
</div>



  

  
  <article class="post-body">
    <h2 class="post-title">
      <a href="/videolan/2010/08/27/update-to-a-safer-vlc.html">
        Update to a safer VLC
      </a>
    </h2>
    <div class="post-meta">
  <span class="post-date">27 Aug 2010</span>
  <span class="post-categories">
    
      &bull;

      
      
      

      
        <a href="/category/videolan.html">
          VideoLAN
        </a>
      
    
  </span>
</div>

    
      <p>VLC 1.1.4 is out, with <a href="http://git.videolan.org/?p=vlc/vlc-1.1.git;a=commit;h=43a31df56c37bd62c691cdbe3c1f11babd164b56">a fix</a> for the <a href="http://unhandledexpression.com/2010/08/23/fixing-the-dll-loading-vulnerability/">DLL preloading attack</a>!</p>
<p>Read more about that issue in the <a href="http://www.videolan.org/vlc/releases/1.1.4.html">release notes</a> and the <a href="http://www.videolan.org/security/sa1005.html">security advisory</a>.</p>

    

    
      
      
      

      
    
  </article>
  
  <article class="post-body">
    <h2 class="post-title">
      <a href="/general/security/videolan/2010/08/23/fixing-the-dll-loading-vulnerability.html">
        Fixing the DLL loading vulnerability
      </a>
    </h2>
    <div class="post-meta">
  <span class="post-date">23 Aug 2010</span>
  <span class="post-categories">
    
      &bull;

      
      
      

      
        General
      
    
      &bull;

      
      
      

      
        <a href="/category/security.html">
          Security
        </a>
      
    
      &bull;

      
      
      

      
        <a href="/category/videolan.html">
          VideoLAN
        </a>
      
    
  </span>
</div>

    
      <p><strong>Update 24/08/2010: Microsoft published an <a href="https://www.microsoft.com/technet/security/advisory/2269637.mspx">advisory</a>, there's an <a href="http://blogs.technet.com/b/srd/archive/2010/08/23/more-information-about-dll-preloading-remote-attack-vector.aspx">article from the MSRC</a> about the preloading DLL vulnerability, and <a href="http://support.microsoft.com/kb/2264107">a tool</a> that fixes the problem. And if you want to know more, there's an <a href="http://msdn.microsoft.com/en-us/library/ff919712(VS.85).aspx">MSDN article</a>.</strong></p>
<p><strong>Update 25/08/2010: if you came here from golem.de, heise.de or h-online.com, good for you! The articles on these websites are blatantly wrong, and their proposed solution doesn't work . You will find here the real solutions, and links to the relevant blog posts and advisories.</strong></p>
<p>Look! <a href="http://www.securityfocus.com/archive/1/513190">A new</a> <a href="http://www.cs.ucdavis.edu/research/tech-reports/2010/CSE-2010-2.pdf">shiny</a> <a href="http://blog.metasploit.com/2010/08/exploiting-dll-hijacking-flaws.html">vulnerability</a>, affecting a lot of Windows applications! OMG OMG OMG we're DOOMED!</p>
<p>&lt;/crazy mode off&gt;</p>
<p>OK, let's get serious. This vulnerability is actually <a href="http://www.securityfocus.com/bid/1699/discuss">a very old one</a>. It is there because the <a href="http://msdn.microsoft.com/en-us/library/ms682586(v=VS.85).aspx">DLL search order</a> includes the current directory (if someone can tell me why, I would be delighted to know that). Here is the search order (source: <a href="http://msdn.microsoft.com/en-us/library/ms682586(v=VS.85).aspx">MSDN</a>):</p>
<blockquote><p>If <strong>SafeDllSearchMode</strong> is enabled, the search order is as follows:</p>
<ol>
<li>The directory from which the application loaded.</li>
<li>The system directory. Use the <a href="http://msdn.microsoft.com/en-us/library/ms724373(v=VS.85).aspx"><strong>GetSystemDirectory</strong></a> function to get the path of this directory.</li>
<li>The 16-bit system directory. There is no function that obtains the path of this directory, but it is searched.</li>
<li>The Windows directory. Use the <a href="http://msdn.microsoft.com/en-us/library/ms724454(v=VS.85).aspx"><strong>GetWindowsDirectory</strong></a> function to get the path of this directory.</li>
<li>The current directory.</li>
<li>The directories that are listed in the PATH environment variable. Note that this does not include the per-application path specified by the <strong>App Paths</strong> registry key. The <strong>App Paths</strong> key is not used when computing the DLL search path.</li>
</ol>
<p>If <strong>SafeDllSearchMode</strong> is disabled, the search order is as follows:</p>
<ol>
<li>The directory from which the application loaded.</li>
<li>The current directory.</li>
<li>The system directory. Use the <a href="http://msdn.microsoft.com/en-us/library/ms724373(v=VS.85).aspx"><strong>GetSystemDirectory</strong></a> function to get the path of this directory.</li>
<li>The 16-bit system directory. There is no function that obtains the path of this directory, but it is searched.</li>
<li>The Windows directory. Use the <a href="http://msdn.microsoft.com/en-us/library/ms724454(v=VS.85).aspx"><strong>GetWindowsDirectory</strong></a> function to get the path of this directory.</li>
</ol>
</blockquote>
<p>For the record: disabling SafeDllSearchMode means that you're stupid, or that you're using a Windows before XP SP1 (note that this is not exclusive).</p>
<p>So, let's assume that your application tries to load a DLL that isn't present, either in your application directory, or in the system directories. Then, the application will try to load the DLL from the current directory. And that's it. If there's a DLL with the same name in that folder, it will be loaded in the application. That's why you can get owned by opening a file in that same directory: it sets the current directory of the application to the file's folder.</p>
<p>OMG OMG OMG we're DOOMED, and it's incredibly easy to exploit me!</p>
<p>So, now, let's take a look at the fix. This is an OS flaw. You can't fix all your applications yourself. H.D. Moore has some <a href="http://blog.rapid7.com/?p=5325">sysadmin fixes</a> that you can apply to prevent the exploit from coming on your computer. But your applications will still be exploitable.</p>
<p>If you're a developer, though, you can fix your application. There's a function that can remove the current directory from the DLL search path: SetDllDirectory. From <a href="http://msdn.microsoft.com/en-us/library/ms686203(VS.85).aspx">MSDN</a>:</p>
<blockquote><p>After calling <strong>SetDllDirectory</strong>, the DLL search path is:</p>
<ol>
<li>The directory from which the application loaded.</li>
<li>The directory specified by the <em>lpPathName</em> parameter.</li>
<li>The system directory. Use the <a href="http://msdn.microsoft.com/en-us/library/ms724373(v=VS.85).aspx"><strong>GetSystemDirectory</strong></a> function to get the path of this directory. The name of this directory is System32.</li>
<li>The 16-bit system directory. There is no function that obtains the path of this directory, but it is searched. The name of this directory is System.</li>
<li>The Windows directory. Use the <a href="http://msdn.microsoft.com/en-us/library/ms724454(v=VS.85).aspx"><strong>GetWindowsDirectory</strong></a> function to get the path of this directory.</li>
<li>The directories that are listed in the PATH environment variable.</li>
</ol>
</blockquote>
<p>So, if you pass a safe directory(let's say, C:\Windows\System32, or your application directory) as argument to SetDllDirectory, you effectively remove the current directory from the search path! It works, I tested it for you :)</p>
<p>But that's not the end: you have to wipe out the PATH to be safe. <a href="http://blog.metasploit.com/2010/08/exploiting-dll-hijacking-flaws.html">From the metasploit blog</a>:</p>
<blockquote><p>If the application is trying to load a DLL that is normally found within the PATH, but not the Windows system directories, and the PATH contains environment variables that have not been set, then the literal value of the environment variable will be treated as sub-directory of the working directory (the share). For example, if %unknownvariable%\bin is in the system PATH, the share will be searched for a directory called “%unknownvariable%\bin” and the target DLL will be loaded from within this sub-directory.</p></blockquote>
<p>And if you test  your application with ProcMon, you will surely see that a lot of (potentially unsafe) directories are added to the PATH, and used to look for the DLL. So, remove all the useless directories from the PATH if you can!</p>
<p>(And now, for the disclaimer: this blog post is not endorsed by Microsoft, and if you want to be really safe and know the best solution to employ, wait for Microsoft's patches and workarounds. But if you trust me enough (you fool... *evil laugh*), you can try that fix on your application, and maybe protect your users. )</p>
<p>Actually, that fix is encouraged by Microsoft, and David Leblanc wrote about it in February 2008.</p>

    

    
      
      
      

      
    
  </article>
  
  <article class="post-body">
    <h2 class="post-title">
      <a href="/videolan/2010/07/22/vlc-1-1-1-is-out-gpu-decoding-for-ati.html">
        VLC 1.1.1 is out: GPU decoding for ATI
      </a>
    </h2>
    <div class="post-meta">
  <span class="post-date">22 Jul 2010</span>
  <span class="post-categories">
    
      &bull;

      
      
      

      
        <a href="/category/videolan.html">
          VideoLAN
        </a>
      
    
  </span>
</div>

    
      <p>VLC 1.1.1 was <a href="http://www.videolan.org/vlc/releases/1.1.1.html">just released</a>! A lot of bugs were fixed, and now, GPU decoding works on ATI cards! You need Catalyst 10.7 to use DxVA on your ATI GPU.</p>
<p>Other important news: libVLC has a lot of new useful functions, like libvlc_set_user_agent(), or libvlc_video_set_callbacks() and libvlc_video_set_format() to replace the <a href="http://www.cplusplus.com/forum/lounge/24239/">--vmem-* hack</a>.</p>
<p>Enjoy this new release!</p>

    

    
      
      
      

      
    
  </article>
  
  <article class="post-body">
    <h2 class="post-title">
      <a href="/general/2010/07/07/i-hate-the-web.html">
        I hate the web
      </a>
    </h2>
    <div class="post-meta">
  <span class="post-date">07 Jul 2010</span>
  <span class="post-categories">
    
      &bull;

      
      
      

      
        General
      
    
  </span>
</div>

    
      <p>I first experienced Internet at the glorious time of the 56k. It was slow, hard to browse, and full of badly designed websites. But it was fun to discover. At that time, people were still trying to figure out the answer to "what the hell can I do here?", were experimenting a lot, and shared their results.</p>
<p>Then the internet bubble grew and... I won't waste time telling <a href="http://en.wikipedia.org/wiki/Dot-com_bubble">that story</a>, that's not my goal here. Let's go forward a little, to that new trend, the Web 2,0.</p>
<p>[youtube=http://www.youtube.com/watch?v=I6IQ_FOCE6I]</p>
<p>It was the beginning of social media, users producing content, companies investing a lot to reach those users. And somewhere, something went wrong. It was quiet at first. People were wondering how to get a better rank in search engines, how to blog, how to create a buzz. Some of them were really trying create value, and share it with the right users. But others didn't think like that. They found a way to make money out of thin air.</p>
<h1>How to be successful on the Interwebz</h1>
<p>Take a lot of incompetent people, more or less linked by a common interest-let's say "being famous", as an example- and able to communicate with each other thanks to social networks. One of them will see a post somewhere describing someone famous, and will share it with the rest. He will share other articles for a few months, and all the incompetent fools will be pleased  to learn about how famous people became famous.</p>
<p>Then, he will begin to write articles that rephrase the ones he sent a few months ago. All the incompetent fools will thank him for sharing his insight in being famous. And if he doesn't find anything to write, he will rephrase one of his own articles, with a catchy title like "top ten ways to create a viral video" and a lot of bullet points. And some of the incompetent fools will share these articles (mostly because they're not smart enough to go and find the original content by themselves).</p>
<p>Little by little, he will be recognized as an expert in being famous, and will start a consultant job, and will be overpaid to teach the incompetent fools how to be famous. And then, those incompetent fools will start to share themselves, and blog, and become consultants and make money. Don't you recognize <a href="http://en.wikipedia.org/wiki/Ponzi_scheme">something</a>?</p>
<h1>The <span style="text-decoration:line-through;">Ponzi scheme</span> web 2.0 expert</h1>
<p>That's the Internet we see now, and I find it disgusting. No real content, people quoting each other, and experts telling us "Get rich following my method, it worked for me, why wouldn't it work for you?". Social networks gave the crooks an easy way to legitimacy. Why would you bother working hard, when you can quickly get exposure by preaching to the incompetent crowd?</p>
<p>If you follow most of the news, you will think that those people talking about SEO, copywriting, web marketing or community management are the ones building the web. They're not. Internet is there thanks to a lot of quiet system administrators, developers and electronics engineers. They're not necessarily following new trends. They're at their origin.</p>
<p>If you want real content and real value, look for these people. If you want to build something useful, learn from them but follow your own path. Inventing is not about repeating what smart people say, but contradicting them.</p>

    

    
      
      
      

      
    
  </article>
  
  <article class="post-body">
    <h2 class="post-title">
      <a href="/security/videolan/2010/07/02/current-state-of-security-in-vlc-on-windows.html">
        Current state of security in VLC on Windows
      </a>
    </h2>
    <div class="post-meta">
  <span class="post-date">02 Jul 2010</span>
  <span class="post-categories">
    
      &bull;

      
      
      

      
        <a href="/category/security.html">
          Security
        </a>
      
    
      &bull;

      
      
      

      
        <a href="/category/videolan.html">
          VideoLAN
        </a>
      
    
  </span>
</div>

    
      <p>A recent report from <a href="http://secunia.com/blog/105">Secunia</a> states that popular Windows applications don't use the DEP and ASLR protections. It is true for VLC up to 1.0: the latest version at the moment, 1.1, supports permanent DEP mode, and ASLR on all of its DLLs.</p>
<p>One thing the report could have shown is the difference between applicatins built with MSVC or GCC. Adding DEP and ASLR in Visual Studio means adding /NXCompat and DynamicBase to the compilation options. With MinGW, there is a <a href="http://eleves.ec-lille.fr/~couprieg/post/Enable-DEP-and-ASLR-on-your-applications-built-with-MinGW">different trick</a>. This article on my old blog is slightly outdated: ld in binutils 2.20 supports the --nxcompat and --dynamicbase options. So, now, the developers using GCC have no more excuse!</p>
<p>Let's sum up the state of the security of VLC:</p>
<ul>
<li>1.0.5 is NOT SAFE on Windows. 1.0.6 brings a lot of <a href="http://www.videolan.org/security/sa1003.html">security fixes</a>, but this version was not released on Windows. And security features are not used.</li>
<li>1.1.0 supports permanent DEP and ASLR (with DllCharacteristics flag, only on Vista/7) and termination on heap corruption</li>
<li>1.1.1 supports the same as 1.1.0, and adds DEP on XP SP3 with SetProcessDEPPolicy</li>
<li>SafeSEH and stack cookies are not yet used</li>
</ul>
<p>The developers using LibVLC should check their software: DEP won't be activated if their executable doesn't support it.</p>

    

    
      
      
      

      
    
  </article>
  

  
<div class="pagination">
  <a class="pagination-item older"
     href="/page11">
    Older
  </a>
</div>


</div>
    </main>

    <!-- Optional footer content -->

  </body>
</html>
